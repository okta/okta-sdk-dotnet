// <copyright file="RealmApiTests.cs" company="Okta, Inc">
// Copyright (c) 2014-present Okta, Inc. All rights reserved.
// Licensed under the Apache 2.0 license. See the LICENSE file in the project root for full license information.
// </copyright>

/*
 * Okta API
 *
 * Allows customers to easily access the Okta API
 *
 * The version of the OpenAPI document: 5.1.0
 * Contact: devex-public@okta.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System;
using System.Collections.Generic;
using System.Net;
using System.Threading.Tasks;
using FluentAssertions;
using Okta.Sdk.Api;
using Okta.Sdk.Client;
using Okta.Sdk.Model;
using Okta.Sdk.UnitTest.Internal;
using Xunit;

namespace Okta.Sdk.UnitTest.Api
{
    /// <summary>
    ///  Class for testing RealmApi
    /// </summary>
    public class RealmApiTests
    {
        #region CreateRealm Tests

        [Fact]
        public async Task CreateRealm_WithValidData_ReturnsRealm()
        {
            // Arrange
            var realmId = "realm-123";
            var realmName = "Test Realm";
            var domain = "test-partner.com";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": """ + realmName + @""",
                    ""domains"": [""" + domain + @"""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new CreateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = realmName,
                    Domains = [domain],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            var realm = await realmApi.CreateRealmAsync(request);

            // Assert
            realm.Should().NotBeNull();
            realm.Id.Should().Be(realmId);
            realm.IsDefault.Should().BeFalse();
            realm.Profile.Should().NotBeNull();
            realm.Profile.Name.Should().Be(realmName);
            realm.Profile.Domains.Should().ContainSingle();
            realm.Profile.Domains[0].Should().Be(domain);
            realm.Profile.RealmType.Should().Be(RealmProfile.RealmTypeEnum.PARTNER);

            mockClient.ReceivedPath.Should().Be("/api/v1/realms");
            mockClient.ReceivedBody.Should().Contain(realmName);
            mockClient.ReceivedBody.Should().Contain(domain);
        }

        [Fact]
        public async Task CreateRealm_WithMultipleDomains_ReturnsRealmWithAllDomains()
        {
            // Arrange
            var domains = new List<string> { "partner1.com", "partner2.com", "partner3.com" };
            
            var responseJson = @"{
                ""id"": ""realm-multi-123"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Multi Domain Realm"",
                    ""domains"": [""partner1.com"", ""partner2.com"", ""partner3.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/realm-multi-123""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new CreateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Multi Domain Realm",
                    Domains = domains,
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            var realm = await realmApi.CreateRealmAsync(request);

            // Assert
            realm.Should().NotBeNull();
            realm.Profile.Domains.Should().HaveCount(3);
            realm.Profile.Domains.Should().Contain(domains);
        }

        [Fact]
        public async Task CreateRealm_WithoutDomains_ReturnsRealmWithEmptyDomains()
        {
            // Arrange
            var responseJson = @"{
                ""id"": ""realm-no-domains-123"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""No Domains Realm"",
                    ""domains"": [],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/realm-no-domains-123""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new CreateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "No Domains Realm",
                    Domains = [],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            var realm = await realmApi.CreateRealmAsync(request);

            // Assert
            realm.Should().NotBeNull();
            realm.Profile.Domains.Should().NotBeNull();
            realm.Profile.Domains.Should().BeEmpty();
        }

        [Fact]
        public async Task CreateRealm_CallsCorrectEndpoint()
        {
            // Arrange
            var responseJson = @"{
                ""id"": ""realm-123"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Test Realm"",
                    ""domains"": [""test.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/realm-123""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new CreateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Test Realm",
                    Domains = ["test.com"],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            await realmApi.CreateRealmAsync(request);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/realms");
        }

        [Fact]
        public async Task CreateRealm_SetsTimestampProperties()
        {
            // Arrange
            var createdDate = "2025-10-05T10:30:00.000Z";
            var updatedDate = "2025-10-05T11:45:00.000Z";
            
            var responseJson = @"{
                ""id"": ""realm-timestamps-123"",
                ""created"": """ + createdDate + @""",
                ""lastUpdated"": """ + updatedDate + @""",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Timestamp Test Realm"",
                    ""domains"": [""timestamp.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/realm-timestamps-123""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new CreateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Timestamp Test Realm",
                    Domains = ["timestamp.com"],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            var realm = await realmApi.CreateRealmAsync(request);

            // Assert
            realm.Created.Should().NotBe(default(DateTimeOffset));
            realm.LastUpdated.Should().NotBe(default(DateTimeOffset));
            realm.Created.ToString("yyyy-MM-ddTHH:mm:ss.fffZ").Should().Be(createdDate);
            realm.LastUpdated.ToString("yyyy-MM-ddTHH:mm:ss.fffZ").Should().Be(updatedDate);
        }

        #endregion

        #region GetRealm Tests

        [Fact]
        public async Task GetRealm_WithValidId_ReturnsRealm()
        {
            // Arrange
            var realmId = "realm-get-123";
            var realmName = "Retrieved Realm";
            var domain = "retrieved.com";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-10-05T08:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T09:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": """ + realmName + @""",
                    ""domains"": [""" + domain + @"""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var realm = await realmApi.GetRealmAsync(realmId);

            // Assert
            realm.Should().NotBeNull();
            realm.Id.Should().Be(realmId);
            realm.Profile.Name.Should().Be(realmName);
            realm.Profile.Domains.Should().ContainSingle();
            realm.Profile.Domains[0].Should().Be(domain);
            
            mockClient.ReceivedPath.Should().StartWith("/api/v1/realms/{realmId}");
            mockClient.ReceivedPathParams["realmId"].Should().Contain(realmId);
        }

        [Fact]
        public async Task GetRealm_WithDefaultRealm_ReturnsDefaultRealm()
        {
            // Arrange
            var realmId = "realm-default-123";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-01-01T00:00:00.000Z"",
                ""lastUpdated"": ""2025-01-01T00:00:00.000Z"",
                ""isDefault"": true,
                ""profile"": {
                    ""name"": ""Default Realm"",
                    ""domains"": [],
                    ""realmType"": ""DEFAULT""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var realm = await realmApi.GetRealmAsync(realmId);

            // Assert
            realm.Should().NotBeNull();
            realm.IsDefault.Should().BeTrue();
            realm.Profile.RealmType.Should().Be(RealmProfile.RealmTypeEnum.DEFAULT);
        }

        [Fact]
        public async Task GetRealm_IncludesLinksProperty()
        {
            // Arrange
            var realmId = "realm-links-123";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-10-05T08:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T09:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Links Realm"",
                    ""domains"": [""links.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var realm = await realmApi.GetRealmAsync(realmId);

            // Assert
            realm.Links.Should().NotBeNull();
            realm.Links.Self.Should().NotBeNull();
            realm.Links.Self.Href.Should().Contain(realmId);
        }

        [Fact]
        public async Task GetRealm_CallsCorrectEndpointWithRealmId()
        {
            // Arrange
            var realmId = "realm-endpoint-test-123";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-10-05T08:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T09:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Endpoint Test Realm"",
                    ""domains"": [""endpoint.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await realmApi.GetRealmAsync(realmId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/realms/{realmId}");
            mockClient.ReceivedPathParams.Should().ContainKey("realmId");
            mockClient.ReceivedPathParams["realmId"].Should().Contain(realmId);
        }

        #endregion

        #region ListRealms Tests

        [Fact]
        public void ListRealms_ReturnsCollection()
        {
            // Arrange
            var responseJson = @"[]";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var realmsCollection = realmApi.ListRealms();

            // Assert
            realmsCollection.Should().NotBeNull();
        }

        [Fact]
        public void ListRealms_WithSearchParameter_ReturnsCollection()
        {
            // Arrange
            var responseJson = @"[]";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var realmsCollection = realmApi.ListRealms(search: "profile.name eq \"Searched Realm\"");

            // Assert
            realmsCollection.Should().NotBeNull();
        }

        [Fact]
        public void ListRealms_WithLimitParameter_ReturnsCollection()
        {
            // Arrange
            var responseJson = @"[]";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var realmsCollection = realmApi.ListRealms(limit: 10);

            // Assert
            realmsCollection.Should().NotBeNull();
        }

        #endregion

        #region ReplaceRealm Tests

        [Fact]
        public async Task ReplaceRealm_WithUpdatedName_ReturnsUpdatedRealm()
        {
            // Arrange
            var realmId = "realm-update-123";
            var updatedName = "Updated Realm Name";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-10-05T08:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T14:30:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": """ + updatedName + @""",
                    ""domains"": [""updated.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new UpdateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = updatedName,
                    Domains = ["updated.com"],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            var realm = await realmApi.ReplaceRealmAsync(realmId, request);

            // Assert
            realm.Should().NotBeNull();
            realm.Id.Should().Be(realmId);
            realm.Profile.Name.Should().Be(updatedName);
            
            mockClient.ReceivedPath.Should().StartWith("/api/v1/realms/{realmId}");
            mockClient.ReceivedPathParams["realmId"].Should().Contain(realmId);
            mockClient.ReceivedBody.Should().Contain(updatedName);
        }

        [Fact]
        public async Task ReplaceRealm_WithUpdatedDomains_ReturnsRealmWithNewDomains()
        {
            // Arrange
            var realmId = "realm-domains-123";
            var newDomains = new List<string> { "domain1.com", "domain2.com" };
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-10-05T08:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T15:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Domain Update Realm"",
                    ""domains"": [""domain1.com"", ""domain2.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new UpdateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Domain Update Realm",
                    Domains = newDomains,
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            var realm = await realmApi.ReplaceRealmAsync(realmId, request);

            // Assert
            realm.Should().NotBeNull();
            realm.Profile.Domains.Should().HaveCount(2);
            realm.Profile.Domains.Should().Contain(newDomains);
            
            mockClient.ReceivedBody.Should().Contain("domain1.com");
            mockClient.ReceivedBody.Should().Contain("domain2.com");
        }

        [Fact]
        public async Task ReplaceRealm_UpdatesLastUpdatedTimestamp()
        {
            // Arrange
            var realmId = "realm-timestamp-123";
            var newUpdatedTime = "2025-10-05T16:45:00.000Z";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-10-05T08:00:00.000Z"",
                ""lastUpdated"": """ + newUpdatedTime + @""",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Timestamp Update Realm"",
                    ""domains"": [""timestamp.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new UpdateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Timestamp Update Realm",
                    Domains = ["timestamp.com"],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            var realm = await realmApi.ReplaceRealmAsync(realmId, request);

            // Assert
            realm.Should().NotBeNull();
            realm.LastUpdated.Should().NotBe(default(DateTimeOffset));
            realm.LastUpdated.ToString("yyyy-MM-ddTHH:mm:ss.fffZ").Should().Be(newUpdatedTime);
        }

        [Fact]
        public async Task ReplaceRealm_CallsCorrectEndpoint()
        {
            // Arrange
            var realmId = "realm-endpoint-123";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-10-05T08:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T14:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Endpoint Test Realm"",
                    ""domains"": [""endpoint.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new UpdateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Endpoint Test Realm",
                    Domains = ["endpoint.com"],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            await realmApi.ReplaceRealmAsync(realmId, request);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/realms/{realmId}");
            mockClient.ReceivedPathParams["realmId"].Should().Contain(realmId);
        }

        #endregion

        #region DeleteRealm Tests

        [Fact]
        public async Task DeleteRealm_WithValidId_CallsCorrectEndpoint()
        {
            // Arrange
            var realmId = "realm-delete-123";
            
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await realmApi.DeleteRealmAsync(realmId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/realms/{realmId}");
            mockClient.ReceivedPathParams["realmId"].Should().Contain(realmId);
        }

        [Fact]
        public async Task DeleteRealm_SuccessfulDeletion_ReturnsNoContent()
        {
            // Arrange
            var realmId = "realm-delete-success-123";
            
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var result = await realmApi.DeleteRealmWithHttpInfoAsync(realmId);

            // Assert
            result.StatusCode.Should().Be(HttpStatusCode.NoContent);
        }

        [Fact]
        public async Task DeleteRealm_WithRealmId_PassesIdInPath()
        {
            // Arrange
            var realmId = "realm-path-123";
            
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await realmApi.DeleteRealmAsync(realmId);

            // Assert
            mockClient.ReceivedPathParams.Should().ContainKey("realmId");
            mockClient.ReceivedPathParams["realmId"].Should().Contain(realmId);
        }

        #endregion

        #region Realm Model Property Tests

        [Fact]
        public async Task Realm_ReadOnlyProperties_AreSetFromResponse()
        {
            // Arrange
            var realmId = "realm-readonly-123";
            var createdDate = "2025-10-05T10:00:00.000Z";
            var updatedDate = "2025-10-05T11:00:00.000Z";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": """ + createdDate + @""",
                ""lastUpdated"": """ + updatedDate + @""",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""ReadOnly Test Realm"",
                    ""domains"": [""readonly.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var realm = await realmApi.GetRealmAsync(realmId);

            // Assert
            realm.Id.Should().Be(realmId);
            realm.Created.Should().NotBe(default(DateTimeOffset));
            realm.LastUpdated.Should().NotBe(default(DateTimeOffset));
            realm.IsDefault.Should().BeFalse();
        }

        [Fact]
        public async Task Realm_ProfileProperty_ContainsAllFields()
        {
            // Arrange
            var responseJson = @"{
                ""id"": ""realm-profile-123"",
                ""created"": ""2025-10-05T10:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T11:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Profile Test Realm"",
                    ""domains"": [""domain1.com"", ""domain2.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/realm-profile-123""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var realm = await realmApi.GetRealmAsync("realm-profile-123");

            // Assert
            realm.Profile.Should().NotBeNull();
            realm.Profile.Name.Should().Be("Profile Test Realm");
            realm.Profile.Domains.Should().HaveCount(2);
            realm.Profile.Domains.Should().Contain(["domain1.com", "domain2.com"]);
            realm.Profile.RealmType.Should().Be(RealmProfile.RealmTypeEnum.PARTNER);
        }

        [Fact]
        public async Task Realm_LinksProperty_ContainsSelfLink()
        {
            // Arrange
            var realmId = "realm-links-test-123";
            
            var responseJson = @"{
                ""id"": """ + realmId + @""",
                ""created"": ""2025-10-05T10:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T11:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Links Test Realm"",
                    ""domains"": [""links.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/" + realmId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var realm = await realmApi.GetRealmAsync(realmId);

            // Assert
            realm.Links.Should().NotBeNull();
            realm.Links.Self.Should().NotBeNull();
            realm.Links.Self.Href.Should().NotBeNullOrEmpty();
            realm.Links.Self.Href.Should().Contain("/api/v1/realms/");
            realm.Links.Self.Href.Should().Contain(realmId);
        }

        [Fact]
        public async Task Realm_RealmTypeEnum_SupportsPartnerAndDefault()
        {
            // Arrange - Test PARTNER type
            var partnerResponseJson = @"{
                ""id"": ""realm-partner-123"",
                ""created"": ""2025-10-05T10:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T11:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Partner Realm"",
                    ""domains"": [""partner.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/realm-partner-123""
                    }
                }
            }";

            var defaultResponseJson = @"{
                ""id"": ""realm-default-123"",
                ""created"": ""2025-10-05T10:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T11:00:00.000Z"",
                ""isDefault"": true,
                ""profile"": {
                    ""name"": ""Default Realm"",
                    ""domains"": [],
                    ""realmType"": ""DEFAULT""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/realm-default-123""
                    }
                }
            }";

            var partnerMockClient = new MockAsyncClient(partnerResponseJson);
            var defaultMockClient = new MockAsyncClient(defaultResponseJson);
            
            var partnerRealmApi = new RealmApi(partnerMockClient, new Configuration { BasePath = "https://test.okta.com" });
            var defaultRealmApi = new RealmApi(defaultMockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var partnerRealm = await partnerRealmApi.GetRealmAsync("realm-partner-123");
            var defaultRealm = await defaultRealmApi.GetRealmAsync("realm-default-123");

            // Assert
            partnerRealm.Profile.RealmType.Should().Be(RealmProfile.RealmTypeEnum.PARTNER);
            partnerRealm.IsDefault.Should().BeFalse();
            
            defaultRealm.Profile.RealmType.Should().Be(RealmProfile.RealmTypeEnum.DEFAULT);
            defaultRealm.IsDefault.Should().BeTrue();
        }

        #endregion

        #region Error Handling Tests

        [Fact]
        public async Task CreateRealm_WithInvalidProfile_ThrowsApiException()
        {
            // Arrange
            var errorJson = @"{
                ""errorCode"": ""E0000001"",
                ""errorSummary"": ""Api validation failed: name"",
                ""errorLink"": ""E0000001"",
                ""errorId"": ""error-123"",
                ""errorCauses"": [
                    {
                        ""errorSummary"": ""name: The field is required.""
                    }
                ]
            }";

            var mockClient = new MockAsyncClient(errorJson, HttpStatusCode.BadRequest);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new CreateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "", // Invalid empty name
                    Domains = ["test.com"],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act & Assert
            await Assert.ThrowsAsync<ApiException>(async () =>
            {
                await realmApi.CreateRealmAsync(request);
            });
        }

        [Fact]
        public async Task GetRealm_WithNonExistentId_ThrowsApiException()
        {
            // Arrange
            var errorJson = @"{
                ""errorCode"": ""E0000007"",
                ""errorSummary"": ""Not found: Resource not found: non-existent-realm-id (Realm)"",
                ""errorLink"": ""E0000007"",
                ""errorId"": ""error-404"",
                ""errorCauses"": []
            }";

            var mockClient = new MockAsyncClient(errorJson, HttpStatusCode.NotFound);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert
            await Assert.ThrowsAsync<ApiException>(async () =>
            {
                await realmApi.GetRealmAsync("non-existent-realm-id");
            });
        }

        [Fact]
        public async Task DeleteRealm_WithNonExistentId_ThrowsApiException()
        {
            // Arrange
            var errorJson = @"{
                ""errorCode"": ""E0000007"",
                ""errorSummary"": ""Not found: Resource not found: non-existent-realm-id (Realm)"",
                ""errorLink"": ""E0000007"",
                ""errorId"": ""error-404"",
                ""errorCauses"": []
            }";

            var mockClient = new MockAsyncClient(errorJson, HttpStatusCode.NotFound);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert
            await Assert.ThrowsAsync<ApiException>(async () =>
            {
                await realmApi.DeleteRealmAsync("non-existent-realm-id");
            });
        }

        [Fact]
        public async Task ReplaceRealm_WithInvalidUpdate_ThrowsApiException()
        {
            // Arrange
            var errorJson = @"{
                ""errorCode"": ""E0000001"",
                ""errorSummary"": ""Api validation failed: domains"",
                ""errorLink"": ""E0000001"",
                ""errorId"": ""error-400"",
                ""errorCauses"": [
                    {
                        ""errorSummary"": ""domains: Invalid domain format.""
                    }
                ]
            }";

            var mockClient = new MockAsyncClient(errorJson, HttpStatusCode.BadRequest);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new UpdateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Test Realm",
                    Domains = ["invalid domain"], // Invalid domain format
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act & Assert
            await Assert.ThrowsAsync<ApiException>(async () =>
            {
                await realmApi.ReplaceRealmAsync("realm-123", request);
            });
        }

        #endregion

        #region WithHttpInfoAsync Method Tests

        [Fact]
        public async Task CreateRealm_WithHttpInfoAsync_ReturnsApiResponseWithHeaders()
        {
            // Arrange
            var responseJson = @"{
                ""id"": ""realm-http-123"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""HTTP Test Realm"",
                    ""domains"": [""httptest.com""],
                    ""realmType"": ""PARTNER""
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/realms/realm-http-123""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.Created);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new CreateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "HTTP Test Realm",
                    Domains = ["httptest.com"],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            var response = await realmApi.CreateRealmWithHttpInfoAsync(request);

            // Assert
            response.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.Created);
            response.Data.Should().NotBeNull();
            response.Data.Id.Should().Be("realm-http-123");
            response.Data.Profile.Name.Should().Be("HTTP Test Realm");

            mockClient.ReceivedPath.Should().Be("/api/v1/realms");
        }

        [Fact]
        public async Task GetRealm_WithHttpInfoAsync_ReturnsApiResponse()
        {
            // Arrange
            var responseJson = @"{
                ""id"": ""realm-get-http-123"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Get HTTP Test"",
                    ""domains"": [""gettest.com""],
                    ""realmType"": ""PARTNER""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.OK);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await realmApi.GetRealmWithHttpInfoAsync("realm-get-http-123");

            // Assert
            response.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.OK);
            response.Data.Should().NotBeNull();
            response.Data.Id.Should().Be("realm-get-http-123");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/realms/{realmId}");
            mockClient.ReceivedPathParams["realmId"].Should().Contain("realm-get-http-123");
        }

        [Fact]
        public async Task ReplaceRealm_WithHttpInfoAsync_ReturnsApiResponse()
        {
            // Arrange
            var responseJson = @"{
                ""id"": ""realm-replace-http-123"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-06T14:00:00.000Z"",
                ""isDefault"": false,
                ""profile"": {
                    ""name"": ""Replaced HTTP Test"",
                    ""domains"": [""replacetest.com""],
                    ""realmType"": ""PARTNER""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.OK);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new UpdateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Replaced HTTP Test",
                    Domains = ["replacetest.com"],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            // Act
            var response = await realmApi.ReplaceRealmWithHttpInfoAsync("realm-replace-http-123", request);

            // Assert
            response.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.OK);
            response.Data.Should().NotBeNull();
            response.Data.Profile.Name.Should().Be("Replaced HTTP Test");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/realms/{realmId}");
            mockClient.ReceivedPathParams["realmId"].Should().Contain("realm-replace-http-123");
        }

        [Fact]
        public async Task DeleteRealm_WithHttpInfoAsync_ReturnsNoContent()
        {
            // Arrange
            var mockClient = new MockAsyncClient(string.Empty, HttpStatusCode.NoContent);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await realmApi.DeleteRealmWithHttpInfoAsync("realm-delete-http-123");

            // Assert
            response.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.NoContent);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/realms/{realmId}");
            mockClient.ReceivedPathParams["realmId"].Should().Contain("realm-delete-http-123");
        }

        #endregion

        #region ListRealms Parameter Tests

        [Fact]
        public async Task ListRealms_WithSortByParameter_IncludesSortByInPath()
        {
            // Arrange
            var responseJson = @"[
                {
                    ""id"": ""realm-sort-1"",
                    ""profile"": { ""name"": ""Realm A"" }
                },
                {
                    ""id"": ""realm-sort-2"",
                    ""profile"": { ""name"": ""Realm B"" }
                }
            ]";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.OK);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var collection = realmApi.ListRealms(sortBy: "profile.name");
            await foreach (var realm in collection)
            {
                realm.Should().NotBeNull();
            }

            // Assert
            mockClient.ReceivedQueryParams["sortBy"].Should().Contain("profile.name");
        }

        [Fact]
        public async Task ListRealms_WithSortOrderParameter_IncludesSortOrderInPath()
        {
            // Arrange
            var responseJson = @"[
                {
                    ""id"": ""realm-desc-1"",
                    ""profile"": { ""name"": ""Realm Z"" }
                }
            ]";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.OK);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var collection = realmApi.ListRealms(sortOrder: "desc");
            await foreach (var realm in collection)
            {
                realm.Should().NotBeNull();
            }

            // Assert
            mockClient.ReceivedQueryParams["sortOrder"].Should().Contain("desc");
        }

        [Fact]
        public async Task ListRealms_WithSortByAndSortOrder_IncludesBothParameters()
        {
            // Arrange
            var responseJson = @"[
                {
                    ""id"": ""realm-both-1"",
                    ""profile"": { ""name"": ""Realm Z"" }
                },
                {
                    ""id"": ""realm-both-2"",
                    ""profile"": { ""name"": ""Realm A"" }
                }
            ]";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.OK);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var collection = realmApi.ListRealms(sortBy: "profile.name", sortOrder: "desc");
            await foreach (var realm in collection)
            {
                realm.Should().NotBeNull();
            }

            // Assert
            mockClient.ReceivedQueryParams["sortBy"].Should().Contain("profile.name");
            mockClient.ReceivedQueryParams["sortOrder"].Should().Contain("desc");
        }

        [Fact]
        public async Task ListRealms_WithSearchSortByAndSortOrder_IncludesAllParameters()
        {
            // Arrange
            var responseJson = @"[
                {
                    ""id"": ""realm-all-1"",
                    ""profile"": { ""name"": ""Production"" }
                }
            ]";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.OK);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var collection = realmApi.ListRealms(
                search: "profile.name eq \"Production\"", 
                sortBy: "created", 
                sortOrder: "asc"
            );
            await foreach (var realm in collection)
            {
                realm.Should().NotBeNull();
            }

            // Assert
            mockClient.ReceivedQueryParams["search"].Should().Contain("profile.name eq \"Production\"");
            mockClient.ReceivedQueryParams["sortBy"].Should().Contain("created");
            mockClient.ReceivedQueryParams["sortOrder"].Should().Contain("asc");
        }

        [Fact]
        public async Task ListRealms_WithAfterParameter_IncludesAfterInPath()
        {
            // Arrange
            var responseJson = @"[
                {
                    ""id"": ""realm-after-1"",
                    ""profile"": { ""name"": ""Realm After"" }
                }
            ]";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.OK);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var collection = realmApi.ListRealms(after: "cursor-123");
            await foreach (var realm in collection)
            {
                realm.Should().NotBeNull();
            }

            // Assert
            mockClient.ReceivedQueryParams["after"].Should().Contain("cursor-123");
        }

        #endregion

        #region CancellationToken Tests

        [Fact]
        public async Task CreateRealm_WithCancellationToken_SupportsIt()
        {
            // Arrange
            var responseJson = @"{
                ""id"": ""realm-cancel-123"",
                ""profile"": { ""name"": ""Cancel Test"", ""domains"": [""cancel.com""], ""realmType"": ""PARTNER"" }
            }";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.Created);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new CreateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Cancel Test",
                    Domains = ["cancel.com"],
                    RealmType = RealmProfile.RealmTypeEnum.PARTNER
                }
            };

            var cts = new System.Threading.CancellationTokenSource();

            // Act
            var task = realmApi.CreateRealmAsync(request, cancellationToken: cts.Token);
            var result = await task;

            // Assert
            result.Should().NotBeNull();
            result.Id.Should().Be("realm-cancel-123");
        }

        [Fact]
        public async Task GetRealm_WithCancellationToken_SupportsIt()
        {
            // Arrange
            var responseJson = @"{
                ""id"": ""realm-get-cancel-123"",
                ""profile"": { ""name"": ""Get Cancel Test"" }
            }";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.OK);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var cts = new System.Threading.CancellationTokenSource();

            // Act
            var result = await realmApi.GetRealmAsync("realm-get-cancel-123", cancellationToken: cts.Token);

            // Assert
            result.Should().NotBeNull();
            result.Id.Should().Be("realm-get-cancel-123");
        }

        [Fact]
        public async Task ReplaceRealm_WithCancellationToken_SupportsIt()
        {
            // Arrange
            var responseJson = @"{
                ""id"": ""realm-replace-cancel-123"",
                ""profile"": { ""name"": ""Replace Cancel Test"" }
            }";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.OK);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var request = new UpdateRealmRequest
            {
                Profile = new RealmProfile
                {
                    Name = "Replace Cancel Test"
                }
            };

            var cts = new System.Threading.CancellationTokenSource();

            // Act
            var result = await realmApi.ReplaceRealmAsync("realm-replace-cancel-123", request, cancellationToken: cts.Token);

            // Assert
            result.Should().NotBeNull();
            result.Id.Should().Be("realm-replace-cancel-123");
        }

        [Fact]
        public async Task DeleteRealm_WithCancellationToken_SupportsIt()
        {
            // Arrange
            var mockClient = new MockAsyncClient(string.Empty, HttpStatusCode.NoContent);
            var realmApi = new RealmApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var cts = new System.Threading.CancellationTokenSource();

            // Act & Assert
            await realmApi.DeleteRealmAsync("realm-delete-cancel-123", cancellationToken: cts.Token);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/realms/{realmId}");
            mockClient.ReceivedPathParams["realmId"].Should().Contain("realm-delete-cancel-123");
        }

        #endregion
    }
}
