/*
 * Okta API
 *
 * Allows customers to easily access the Okta API
 *
 * The version of the OpenAPI document: 5.1.0
 * Contact: devex-public@okta.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System.Net;
using System.Threading.Tasks;
using FluentAssertions;
using Okta.Sdk.Api;
using Okta.Sdk.Client;
using Okta.Sdk.Model;
using Okta.Sdk.UnitTest.Internal;
using Xunit;

namespace Okta.Sdk.UnitTest.Api
{
    /// <summary>
    ///  Class for testing UserLifecycleApi
    /// </summary>
    public class UserLifecycleApiTests
    {
        #region ActivateUser Tests

        [Fact]
        public async Task ActivateUser_WithSendEmailTrue_ReturnsActivationToken()
        {
            // Arrange
            var userId = "user-activate-123";
            var activationUrl = "https://test.okta.com/welcome/activate?token=abc123";

            var responseJson = @"{
                ""activationUrl"": """ + activationUrl + @""",
                ""activationToken"": ""abc123""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var activationToken = await userLifecycleApi.ActivateUserAsync(userId, sendEmail: true);

            // Assert
            activationToken.Should().NotBeNull();
            activationToken.ActivationUrl.Should().Be(activationUrl);
            activationToken.ActivationToken.Should().Be("abc123");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/activate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().NotBeNull();
        }

        [Fact]
        public async Task ActivateUser_WithSendEmailFalse_ReturnsActivationToken()
        {
            // Arrange
            var userId = "user-activate-456";
            var activationUrl = "https://test.okta.com/welcome/activate?token=def456";

            var responseJson = @"{
                ""activationUrl"": """ + activationUrl + @""",
                ""activationToken"": ""def456""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var activationToken = await userLifecycleApi.ActivateUserAsync(userId, sendEmail: false);

            // Assert
            activationToken.Should().NotBeNull();
            activationToken.ActivationUrl.Should().Be(activationUrl);
            activationToken.ActivationToken.Should().Be("def456");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/activate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        [Fact]
        public async Task ActivateUser_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-activate-789";

            var responseJson = @"{
                ""activationUrl"": ""https://test.okta.com/welcome/activate?token=ghi789"",
                ""activationToken"": ""ghi789""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.ActivateUserAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/activate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        #endregion

        #region DeactivateUser Tests

        [Fact]
        public async Task DeactivateUser_WithSendEmailTrue_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-deactivate-123";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.DeactivateUserAsync(userId, sendEmail: true);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/deactivate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().NotBeNull();
        }

        [Fact]
        public async Task DeactivateUser_WithSendEmailFalse_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-deactivate-456";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.DeactivateUserAsync(userId, sendEmail: false);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/deactivate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        [Fact]
        public async Task DeactivateUser_WithPreferAsync_IncludesPreferHeader()
        {
            // Arrange
            var userId = "user-deactivate-789";
            var preferHeader = PreferHeader.RespondAsync;

            var mockClient = new MockAsyncClient("", HttpStatusCode.Accepted);
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.DeactivateUserAsync(userId, sendEmail: false, prefer: preferHeader);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/deactivate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
            mockClient.ReceivedHeaders.Should().NotBeNull();
        }

        #endregion

        #region ReactivateUser Tests

        [Fact]
        public async Task ReactivateUser_WithSendEmailTrue_ReturnsActivationToken()
        {
            // Arrange
            var userId = "user-reactivate-123";
            var activationUrl = "https://test.okta.com/welcome/reactivate?token=reactivate123";

            var responseJson = @"{
                ""activationUrl"": """ + activationUrl + @""",
                ""activationToken"": ""reactivate123""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var activationToken = await userLifecycleApi.ReactivateUserAsync(userId, sendEmail: true);

            // Assert
            activationToken.Should().NotBeNull();
            activationToken.ActivationUrl.Should().Be(activationUrl);
            activationToken.ActivationToken.Should().Be("reactivate123");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/reactivate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        [Fact]
        public async Task ReactivateUser_WithSendEmailFalse_ReturnsActivationToken()
        {
            // Arrange
            var userId = "user-reactivate-456";
            var activationUrl = "https://test.okta.com/welcome/reactivate?token=reactivate456";

            var responseJson = @"{
                ""activationUrl"": """ + activationUrl + @""",
                ""activationToken"": ""reactivate456""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var activationToken = await userLifecycleApi.ReactivateUserAsync(userId, sendEmail: false);

            // Assert
            activationToken.Should().NotBeNull();
            activationToken.ActivationUrl.Should().Be(activationUrl);
            activationToken.ActivationToken.Should().Be("reactivate456");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/reactivate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        [Fact]
        public async Task ReactivateUser_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-reactivate-789";

            var responseJson = @"{
                ""activationUrl"": ""https://test.okta.com/welcome/reactivate?token=reactivate789"",
                ""activationToken"": ""reactivate789""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.ReactivateUserAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/reactivate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        #endregion

        #region SuspendUser Tests

        [Fact]
        public async Task SuspendUser_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-suspend-123";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.SuspendUserAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/suspend");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        [Fact]
        public async Task SuspendUser_WithValidUserId_CompletesSuccessfully()
        {
            // Arrange
            var userId = "user-suspend-456";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert
            await userLifecycleApi.SuspendUserAsync(userId);
            // If no exception is thrown, the test passes
        }

        #endregion

        #region UnsuspendUser Tests

        [Fact]
        public async Task UnsuspendUser_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-unsuspend-123";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.UnsuspendUserAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/unsuspend");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        [Fact]
        public async Task UnsuspendUser_WithValidUserId_CompletesSuccessfully()
        {
            // Arrange
            var userId = "user-unsuspend-456";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert
            await userLifecycleApi.UnsuspendUserAsync(userId);
            // If no exception is thrown, the test passes
        }

        #endregion

        #region UnlockUser Tests

        [Fact]
        public async Task UnlockUser_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-unlock-123";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.UnlockUserAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/unlock");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        [Fact]
        public async Task UnlockUser_WithValidUserId_CompletesSuccessfully()
        {
            // Arrange
            var userId = "user-unlock-456";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert
            await userLifecycleApi.UnlockUserAsync(userId);
            // If no exception is thrown, the test passes
        }

        #endregion

        #region ResetFactors Tests

        [Fact]
        public async Task ResetFactors_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-reset-factors-123";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.ResetFactorsAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/reset_factors");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        [Fact]
        public async Task ResetFactors_WithValidUserId_CompletesSuccessfully()
        {
            // Arrange
            var userId = "user-reset-factors-456";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert
            await userLifecycleApi.ResetFactorsAsync(userId);
            // If no exception is thrown, the test passes
        }

        #endregion

        #region End-to-End Lifecycle Scenario Tests

        [Fact]
        public async Task UserLifecycle_ActivateToSuspendToUnsuspend_CallsCorrectEndpoints()
        {
            // Arrange
            var userId = "user-lifecycle-scenario-123";

            // Test activation
            var activationResponseJson = @"{
                ""activationUrl"": ""https://test.okta.com/welcome/activate?token=scenario123"",
                ""activationToken"": ""scenario123""
            }";

            var mockClient = new MockAsyncClient(activationResponseJson);
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Activate
            var activationToken = await userLifecycleApi.ActivateUserAsync(userId, sendEmail: false);

            // Assert - Activation
            activationToken.Should().NotBeNull();
            activationToken.ActivationToken.Should().Be("scenario123");
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/activate");

            // Setup for suspend
            mockClient = new MockAsyncClient("");
            userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Suspend
            await userLifecycleApi.SuspendUserAsync(userId);

            // Assert - Suspend
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/suspend");

            // Setup for unsuspend
            mockClient = new MockAsyncClient("");
            userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Unsuspend
            await userLifecycleApi.UnsuspendUserAsync(userId);

            // Assert - Unsuspend
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/unsuspend");
        }

        [Fact]
        public async Task UserLifecycle_ReactivateAfterDeactivate_CallsCorrectEndpoints()
        {
            // Arrange
            var userId = "user-reactivate-scenario-456";

            // Test deactivation
            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Deactivate
            await userLifecycleApi.DeactivateUserAsync(userId, sendEmail: false);

            // Assert - Deactivation
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/deactivate");

            // Setup for reactivate
            var reactivationResponseJson = @"{
                ""activationUrl"": ""https://test.okta.com/welcome/reactivate?token=reactivate456"",
                ""activationToken"": ""reactivate456""
            }";

            mockClient = new MockAsyncClient(reactivationResponseJson);
            userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Reactivate
            var activationToken = await userLifecycleApi.ReactivateUserAsync(userId, sendEmail: true);

            // Assert - Reactivation
            activationToken.Should().NotBeNull();
            activationToken.ActivationToken.Should().Be("reactivate456");
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/reactivate");
        }

        #endregion

        #region Error Handling Tests

        [Fact]
        public async Task ActivateUser_WithEmptyUserId_StillCallsEndpoint()
        {
            // Arrange
            var userId = "";

            var responseJson = @"{
                ""activationUrl"": ""https://test.okta.com/welcome/activate?token=empty"",
                ""activationToken"": ""empty""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var activationToken = await userLifecycleApi.ActivateUserAsync(userId);

            // Assert
            activationToken.Should().NotBeNull();
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/activate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
        }

        [Fact]
        public async Task DeactivateUser_WithLongUserId_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-with-very-long-identifier-that-might-cause-issues-in-some-systems-123456789";

            var mockClient = new MockAsyncClient("");
            var userLifecycleApi = new UserLifecycleApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userLifecycleApi.DeactivateUserAsync(userId, sendEmail: false);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/deactivate");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        #endregion
    }
}
