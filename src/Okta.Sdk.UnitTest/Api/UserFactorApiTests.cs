// <copyright file="UserFactorApiTests.cs" company="Okta, Inc">
// Copyright (c) 2014-present Okta, Inc. All rights reserved.
// Licensed under the Apache 2.0 license. See the LICENSE file in the project root for full license information.
// </copyright>

ï»¿/*
 * Okta API
 *
 * Allows customers to easily access the Okta API
 *
 * The version of the OpenAPI document: 5.1.0
 * Contact: devex-public@okta.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System.Threading.Tasks;
using FluentAssertions;
using Okta.Sdk.Api;
using Okta.Sdk.Client;
using Okta.Sdk.Model;
using Okta.Sdk.UnitTest.Internal;
using Xunit;

namespace Okta.Sdk.UnitTest.Api
{
    /// <summary>
    ///  Class for testing UserFactorApi
    /// </summary>
    public class UserFactorApiTests
    {
        #region EnrollFactor Tests

        [Fact]
        public async Task EnrollFactor_WithSMSFactor_ReturnsEnrolledFactor()
        {
            // Arrange
            var userId = "user-enroll-123";
            var factorId = "factor-sms-456";
            var phoneNumber = "+1234567890";

            var responseJson = @"{
                ""id"": """ + factorId + @""",
                ""factorType"": ""sms"",
                ""provider"": ""OKTA"",
                ""status"": ""PENDING_ACTIVATION"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""profile"": {
                    ""phoneNumber"": """ + phoneNumber + @"""
                },
                ""_links"": {
                    ""activate"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/factors/" + factorId + @"/activate""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var factor = new UserFactorSMS
            {
                FactorType = UserFactorType.Sms,
                Provider = UserFactorSMS.ProviderEnum.OKTA,
                Profile = new UserFactorSMSProfile
                {
                    PhoneNumber = phoneNumber
                }
            };

            // Act
            var enrolledFactor = await userFactorApi.EnrollFactorAsync(userId, factor);

            // Assert
            enrolledFactor.Should().NotBeNull();
            enrolledFactor.Id.Should().Be(factorId);
            enrolledFactor.Status.Should().Be(UserFactorStatus.PENDINGACTIVATION);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain(phoneNumber);
        }

        [Fact]
        public async Task EnrollFactor_WithTOTPFactor_ReturnsEnrolledFactor()
        {
            // Arrange
            var userId = "user-enroll-789";
            var factorId = "factor-totp-012";

            var responseJson = @"{
                ""id"": """ + factorId + @""",
                ""factorType"": ""token:software:totp"",
                ""provider"": ""OKTA"",
                ""status"": ""PENDING_ACTIVATION"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""profile"": {
                    ""credentialId"": ""test-credential-id""
                },
                ""_embedded"": {
                    ""activation"": {
                        ""qrcode"": {
                            ""href"": ""https://test.okta.com/qr/totp-qr-code""
                        },
                        ""sharedSecret"": ""JBSWY3DPEHPK3PXP""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var factor = new UserFactorTokenSoftwareTOTP
            {
                FactorType = UserFactorType.Tokensoftwaretotp,
                Provider = UserFactorTokenSoftwareTOTP.ProviderEnum.OKTA
            };

            // Act
            var enrolledFactor = await userFactorApi.EnrollFactorAsync(userId, factor);

            // Assert
            enrolledFactor.Should().NotBeNull();
            enrolledFactor.Id.Should().Be(factorId);
            enrolledFactor.Status.Should().Be(UserFactorStatus.PENDINGACTIVATION);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task EnrollFactor_WithActivateTrue_ReturnsActivatedFactor()
        {
            // Arrange
            var userId = "user-activate-123";
            var factorId = "factor-active-456";

            var responseJson = @"{
                ""id"": """ + factorId + @""",
                ""factorType"": ""email"",
                ""provider"": ""OKTA"",
                ""status"": ""ACTIVE"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""profile"": {
                    ""email"": ""user@example.com""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var factor = new UserFactorEmail
            {
                FactorType = UserFactorType.Email,
                Provider = UserFactorEmail.ProviderEnum.OKTA,
                Profile = new UserFactorEmailProfile
                {
                    Email = "user@example.com"
                }
            };

            // Act
            var enrolledFactor = await userFactorApi.EnrollFactorAsync(userId, factor, activate: true);

            // Assert
            enrolledFactor.Should().NotBeNull();
            enrolledFactor.Status.Should().Be(UserFactorStatus.ACTIVE);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors");
            mockClient.ReceivedQueryParams.Should().NotBeNull();
        }

        #endregion

        #region GetFactor Tests

        [Fact]
        public async Task GetFactor_WithValidIds_ReturnsFactor()
        {
            // Arrange
            var userId = "user-get-123";
            var factorId = "factor-get-456";

            var responseJson = @"{
                ""id"": """ + factorId + @""",
                ""factorType"": ""sms"",
                ""provider"": ""OKTA"",
                ""status"": ""ACTIVE"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""profile"": {
                    ""phoneNumber"": ""+1234567890""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var factor = await userFactorApi.GetFactorAsync(userId, factorId);

            // Assert
            factor.Should().NotBeNull();
            factor.Id.Should().Be(factorId);
            factor.Status.Should().Be(UserFactorStatus.ACTIVE);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
        }

        [Fact]
        public async Task GetFactor_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-get-789";
            var factorId = "factor-get-012";

            var responseJson = @"{
                ""id"": """ + factorId + @""",
                ""factorType"": ""token:software:totp"",
                ""provider"": ""OKTA"",
                ""status"": ""ACTIVE"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userFactorApi.GetFactorAsync(userId, factorId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
        }

        #endregion

        #region ActivateFactor Tests

        [Fact]
        public async Task ActivateFactor_WithPasscode_ReturnsActivateResponse()
        {
            // Arrange
            var userId = "user-activate-123";
            var factorId = "factor-activate-456";
            var passcode = "123456";

            var responseJson = @"{
                ""factorResult"": ""SUCCESS"",
                ""factorResultMessage"": ""Factor activation successful""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var activateRequest = new UserFactorActivateRequest(new Sms
            {
                PassCode = passcode
            });

            // Act
            var response = await userFactorApi.ActivateFactorAsync(userId, factorId, activateRequest);

            // Assert
            response.Should().NotBeNull();

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}/lifecycle/activate");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
            mockClient.ReceivedBody.Should().Contain(passcode);
        }

        [Fact]
        public async Task ActivateFactor_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-activate-789";
            var factorId = "factor-activate-012";

            var responseJson = @"{
                ""factorResult"": ""SUCCESS"",
                ""factorResultMessage"": ""Activation successful""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var activateRequest = new UserFactorActivateRequest(new TokenSoftwareTotp
            {
                PassCode = "654321"
            });

            // Act
            await userFactorApi.ActivateFactorAsync(userId, factorId, activateRequest);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}/lifecycle/activate");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
        }

        #endregion

        #region VerifyFactor Tests

        [Fact]
        public async Task VerifyFactor_WithPasscode_ReturnsVerifyResponse()
        {
            // Arrange
            var userId = "user-verify-123";
            var factorId = "factor-verify-456";
            var passcode = "987654";

            var responseJson = @"{
                ""factorResult"": ""SUCCESS"",
                ""factorResultMessage"": ""Factor verification successful""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var verifyRequest = new UserFactorVerifyRequest(new Sms1
            {
                PassCode = passcode
            });

            // Act
            var response = await userFactorApi.VerifyFactorAsync(userId, factorId, body: verifyRequest);

            // Assert
            response.Should().NotBeNull();

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}/verify");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
            mockClient.ReceivedBody.Should().Contain(passcode);
        }

        [Fact]
        public async Task VerifyFactor_WithPushChallenge_ReturnsChallenge()
        {
            // Arrange
            var userId = "user-verify-push-123";
            var factorId = "factor-verify-push-456";

            var responseJson = @"{
                ""factorResult"": ""CHALLENGE"",
                ""factorResultMessage"": ""Push challenge sent"",
                ""_links"": {
                    ""poll"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/factors/" + factorId + @"/transactions/txn-123""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Issue challenge without body for push factor
            var response = await userFactorApi.VerifyFactorAsync(userId, factorId);

            // Assert
            response.Should().NotBeNull();

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}/verify");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
        }

        #endregion

        #region UnenrollFactor Tests

        [Fact]
        public async Task UnenrollFactor_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-unenroll-123";
            var factorId = "factor-unenroll-456";

            var mockClient = new MockAsyncClient("", System.Net.HttpStatusCode.NoContent);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userFactorApi.UnenrollFactorAsync(userId, factorId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
        }

        [Fact]
        public async Task UnenrollFactor_WithRemoveRecovery_IncludesParameter()
        {
            // Arrange
            var userId = "user-unenroll-789";
            var factorId = "factor-unenroll-012";

            var mockClient = new MockAsyncClient("", System.Net.HttpStatusCode.NoContent);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userFactorApi.UnenrollFactorAsync(userId, factorId, removeRecoveryEnrollment: true);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}");
            mockClient.ReceivedQueryParams.Should().NotBeNull();
        }

        #endregion

        #region ListFactors Tests

        [Fact]
        public async Task ListFactors_ReturnsFactorCollection()
        {
            // Arrange
            var userId = "user-list-123";

            var responseJson = @"[
                {
                    ""id"": ""factor-list-1"",
                    ""factorType"": ""sms"",
                    ""provider"": ""OKTA"",
                    ""status"": ""ACTIVE"",
                    ""created"": ""2025-10-05T12:00:00.000Z"",
                    ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                    ""profile"": {
                        ""phoneNumber"": ""+1234567890""
                    }
                },
                {
                    ""id"": ""factor-list-2"",
                    ""factorType"": ""token:software:totp"",
                    ""provider"": ""OKTA"",
                    ""status"": ""ACTIVE"",
                    ""created"": ""2025-10-05T13:00:00.000Z"",
                    ""lastUpdated"": ""2025-10-05T13:00:00.000Z""
                }
            ]";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var factors = await userFactorApi.ListFactorsWithHttpInfoAsync(userId);

            // Assert
            factors.Should().NotBeNull();
            factors.Data.Should().HaveCount(2);
            factors.Data[0].Id.Should().Be("factor-list-1");
            factors.Data[1].Id.Should().Be("factor-list-2");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task ListFactors_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-list-456";

            var responseJson = @"[]";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var factors = await userFactorApi.ListFactorsWithHttpInfoAsync(userId);

            // Assert
            factors.Should().NotBeNull();
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        #endregion

        #region ListSupportedFactors Tests

        [Fact]
        public async Task ListSupportedFactors_ReturnsFactorCollection()
        {
            // Arrange
            var userId = "user-supported-123";

            var responseJson = @"[
                {
                    ""factorType"": ""sms"",
                    ""provider"": ""OKTA"",
                    ""_links"": {
                        ""enroll"": {
                            ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/factors""
                        }
                    }
                },
                {
                    ""factorType"": ""token:software:totp"",
                    ""provider"": ""OKTA"",
                    ""_links"": {
                        ""enroll"": {
                            ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/factors""
                        }
                    }
                }
            ]";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var supportedFactors = await userFactorApi.ListSupportedFactorsWithHttpInfoAsync(userId);

            // Assert
            supportedFactors.Should().NotBeNull();
            supportedFactors.Data.Should().HaveCount(2);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/catalog");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        #endregion

        #region ResendEnrollFactor Tests

        [Fact]
        public async Task ResendEnrollFactor_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-resend-123";
            var factorId = "factor-resend-456";

            var responseJson = @"{
                ""factorResult"": ""CHALLENGE"",
                ""factorResultMessage"": ""Challenge resent""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var resendRequest = new ResendUserFactor();

            // Act
            var response = await userFactorApi.ResendEnrollFactorAsync(userId, factorId, resendRequest);

            // Assert
            response.Should().NotBeNull();

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}/resend");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
        }

        #endregion

        #region GetFactorTransactionStatus Tests

        [Fact]
        public async Task GetFactorTransactionStatus_ReturnsTransactionStatus()
        {
            // Arrange
            var userId = "user-transaction-123";
            var factorId = "factor-transaction-456";
            var transactionId = "txn-789";

            var responseJson = @"{
                ""factorResult"": ""SUCCESS"",
                ""factorResultMessage"": ""Push notification approved""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var transaction = await userFactorApi.GetFactorTransactionStatusAsync(userId, factorId, transactionId);

            // Assert
            transaction.Should().NotBeNull();

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}/transactions/{transactionId}");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams.Should().ContainKey("transactionId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
            mockClient.ReceivedPathParams["transactionId"].Should().Contain(transactionId);
        }

        #endregion

        #region End-to-End Factor Management Scenario Tests

        [Fact]
        public async Task FactorManagement_EnrollActivateVerify_CallsCorrectEndpoints()
        {
            // Arrange
            var userId = "user-scenario-123";
            var factorId = "factor-scenario-456";
            var phoneNumber = "+1234567890";

            // Test enroll factor
            var enrollResponseJson = @"{
                ""id"": """ + factorId + @""",
                ""factorType"": ""sms"",
                ""provider"": ""OKTA"",
                ""status"": ""PENDING_ACTIVATION"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                ""profile"": {
                    ""phoneNumber"": """ + phoneNumber + @"""
                }
            }";

            var mockClient = new MockAsyncClient(enrollResponseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var factor = new UserFactorSMS
            {
                FactorType = UserFactorType.Sms,
                Provider = UserFactorSMS.ProviderEnum.OKTA,
                Profile = new UserFactorSMSProfile
                {
                    PhoneNumber = phoneNumber
                }
            };

            // Act - Enroll Factor
            var enrolledFactor = await userFactorApi.EnrollFactorAsync(userId, factor);

            // Assert - Enroll Factor
            enrolledFactor.Should().NotBeNull();
            enrolledFactor.Status.Should().Be(UserFactorStatus.PENDINGACTIVATION);
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors");

            // Setup for activate factor
            var activateResponseJson = @"{
                ""factorResult"": ""SUCCESS"",
                ""factorResultMessage"": ""Factor activation successful""
            }";

            mockClient = new MockAsyncClient(activateResponseJson);
            userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var activateRequest = new UserFactorActivateRequest(new Sms
            {
                PassCode = "123456"
            });

            // Act - Activate Factor
            var activateResponse = await userFactorApi.ActivateFactorAsync(userId, factorId, activateRequest);

            // Assert - Activate Factor
            activateResponse.Should().NotBeNull();
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}/lifecycle/activate");

            // Setup for verify factor
            var verifyResponseJson = @"{
                ""factorResult"": ""SUCCESS"",
                ""factorResultMessage"": ""Factor verification successful""
            }";

            mockClient = new MockAsyncClient(verifyResponseJson);
            userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var verifyRequest = new UserFactorVerifyRequest(new Sms1
            {
                PassCode = "789012"
            });

            // Act - Verify Factor
            var verifyResponse = await userFactorApi.VerifyFactorAsync(userId, factorId, body: verifyRequest);

            // Assert - Verify Factor
            verifyResponse.Should().NotBeNull();
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}/verify");
        }

        [Fact]
        public async Task FactorManagement_ListThenUnenroll_CallsCorrectEndpoints()
        {
            // Arrange
            var userId = "user-list-unenroll-456";
            var factorId = "factor-to-unenroll-789";

            // Test list factors
            var listResponseJson = @"[
                {
                    ""id"": """ + factorId + @""",
                    ""factorType"": ""sms"",
                    ""provider"": ""OKTA"",
                    ""status"": ""ACTIVE"",
                    ""created"": ""2025-10-05T12:00:00.000Z"",
                    ""lastUpdated"": ""2025-10-05T12:00:00.000Z"",
                    ""profile"": {
                        ""phoneNumber"": ""+1234567890""
                    }
                }
            ]";

            var mockClient = new MockAsyncClient(listResponseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - List Factors
            var factors = await userFactorApi.ListFactorsWithHttpInfoAsync(userId);

            // Assert - List Factors
            factors.Should().NotBeNull();
            factors.Data.Should().HaveCount(1);
            factors.Data[0].Id.Should().Be(factorId);
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors");

            // Setup for unenroll factor
            mockClient = new MockAsyncClient("", System.Net.HttpStatusCode.NoContent);
            userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Unenroll Factor
            await userFactorApi.UnenrollFactorAsync(userId, factorId);

            // Assert - Unenroll Factor
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}");
        }

        #endregion

        #region Edge Case Tests

        [Fact]
        public async Task EnrollFactor_WithEmptyUserId_StillCallsEndpoint()
        {
            // Arrange
            var userId = "";
            var factorId = "factor-empty-user-123";

            var responseJson = @"{
                ""id"": """ + factorId + @""",
                ""factorType"": ""sms"",
                ""provider"": ""OKTA"",
                ""status"": ""PENDING_ACTIVATION"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var factor = new UserFactorSMS
            {
                FactorType = UserFactorType.Sms,
                Provider = UserFactorSMS.ProviderEnum.OKTA
            };

            // Act
            var enrolledFactor = await userFactorApi.EnrollFactorAsync(userId, factor);

            // Assert
            enrolledFactor.Should().NotBeNull();
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
        }

        [Fact]
        public async Task GetFactor_WithLongIds_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-with-very-long-identifier-that-might-cause-issues-in-some-systems-123456789";
            var factorId = "factor-with-very-long-identifier-that-might-cause-issues-in-some-systems-987654321";

            var responseJson = @"{
                ""id"": """ + factorId + @""",
                ""factorType"": ""token:software:totp"",
                ""provider"": ""OKTA"",
                ""status"": ""ACTIVE"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userFactorApi = new UserFactorApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userFactorApi.GetFactorAsync(userId, factorId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/factors/{factorId}");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams.Should().ContainKey("factorId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedPathParams["factorId"].Should().Contain(factorId);
        }

        #endregion
    }
}
