// <copyright file="UserSessionsApiTests.cs" company="Okta, Inc">
// Copyright (c) 2014-present Okta, Inc. All rights reserved.
// Licensed under the Apache 2.0 license. See the LICENSE file in the project root for full license information.
// </copyright>

/*
 * Okta API
 *
 * Allows customers to easily access the Okta API
 *
 * The version of the OpenAPI document: 5.1.0
 * Contact: devex-public@okta.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System.Net;
using System.Threading.Tasks;
using FluentAssertions;
using Okta.Sdk.Api;
using Okta.Sdk.Client;
using Okta.Sdk.Model;
using Okta.Sdk.UnitTest.Internal;
using Xunit;

namespace Okta.Sdk.UnitTest.Api
{
    /// <summary>
    ///  Class for testing UserSessionsApi
    /// </summary>
    public class UserSessionsApiTests
    {
        #region EndUserSessions Tests

        [Fact]
        public async Task EndUserSessions_WithoutKeepCurrent_CallsCorrectEndpoint()
        {
            // Arrange
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.EndUserSessionsAsync();

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/me/lifecycle/delete_sessions");
        }

        [Fact]
        public async Task EndUserSessions_WithKeepCurrentTrue_CallsCorrectEndpoint()
        {
            // Arrange
            var keepCurrent = new KeepCurrent { _KeepCurrent = true };
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.EndUserSessionsAsync(keepCurrent);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/me/lifecycle/delete_sessions");
            mockClient.ReceivedBody.Should().NotBeNullOrEmpty();
            mockClient.ReceivedBody.Should().Contain("keepCurrent");
            mockClient.ReceivedBody.Should().Contain("true");
        }

        [Fact]
        public async Task EndUserSessions_WithKeepCurrentFalse_CallsCorrectEndpoint()
        {
            // Arrange
            var keepCurrent = new KeepCurrent { _KeepCurrent = false };
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.EndUserSessionsAsync(keepCurrent);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/me/lifecycle/delete_sessions");
            mockClient.ReceivedBody.Should().NotBeNullOrEmpty();
            mockClient.ReceivedBody.Should().Contain("keepCurrent");
            mockClient.ReceivedBody.Should().Contain("false");
        }

        [Fact]
        public async Task EndUserSessions_WithHttpInfo_ReturnsCorrectResponse()
        {
            // Arrange
            var keepCurrent = new KeepCurrent { _KeepCurrent = true };
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userSessionsApi.EndUserSessionsWithHttpInfoAsync(keepCurrent);

            // Assert
            response.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.NoContent);
            mockClient.ReceivedPath.Should().Be("/api/v1/users/me/lifecycle/delete_sessions");
        }

        [Fact]
        public async Task EndUserSessions_WithDefaultKeepCurrent_CallsCorrectEndpoint()
        {
            // Arrange
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.EndUserSessionsAsync(default(KeepCurrent));

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/me/lifecycle/delete_sessions");
        }

        [Fact]
        public async Task EndUserSessions_ReturnsNoContent()
        {
            // Arrange
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert - Should not throw
            await userSessionsApi.EndUserSessionsAsync();
            
            // Verify the call was made
            mockClient.ReceivedPath.Should().Be("/api/v1/users/me/lifecycle/delete_sessions");
        }

        #endregion

        #region RevokeUserSessions Tests

        [Fact]
        public async Task RevokeUserSessions_WithUserId_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "test-user-123";
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task RevokeUserSessions_WithOAuthTokensTrue_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "test-user-oauth-123";
            var oauthTokens = true;
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId, oauthTokens);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().ContainKey("oauthTokens");
            mockClient.ReceivedQueryParams["oauthTokens"].Should().Contain("true");
        }

        [Fact]
        public async Task RevokeUserSessions_WithOAuthTokensFalse_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "test-user-oauth-false-123";
            var oauthTokens = false;
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId, oauthTokens);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().ContainKey("oauthTokens");
            mockClient.ReceivedQueryParams["oauthTokens"].Should().Contain("false");
        }

        [Fact]
        public async Task RevokeUserSessions_WithForgetDevicesTrue_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "test-user-forget-123";
            var forgetDevices = true;
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId, forgetDevices: forgetDevices);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().ContainKey("forgetDevices");
            mockClient.ReceivedQueryParams["forgetDevices"].Should().Contain("true");
        }

        [Fact]
        public async Task RevokeUserSessions_WithForgetDevicesFalse_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "test-user-forget-false-123";
            var forgetDevices = false;
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId, forgetDevices: forgetDevices);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().ContainKey("forgetDevices");
            mockClient.ReceivedQueryParams["forgetDevices"].Should().Contain("false");
        }

        [Fact]
        public async Task RevokeUserSessions_WithAllParameters_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "test-user-all-params-123";
            var oauthTokens = true;
            var forgetDevices = false;
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId, oauthTokens, forgetDevices);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().ContainKey("oauthTokens");
            mockClient.ReceivedQueryParams["oauthTokens"].Should().Contain("true");
            mockClient.ReceivedQueryParams.Should().ContainKey("forgetDevices");
            mockClient.ReceivedQueryParams["forgetDevices"].Should().Contain("false");
        }

        [Fact]
        public async Task RevokeUserSessions_WithHttpInfo_ReturnsCorrectResponse()
        {
            // Arrange
            var userId = "test-user-http-info-123";
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userSessionsApi.RevokeUserSessionsWithHttpInfoAsync(userId);

            // Assert
            response.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.NoContent);
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task RevokeUserSessions_WithHttpInfoAndParameters_ReturnsCorrectResponse()
        {
            // Arrange
            var userId = "test-user-http-info-params-123";
            var oauthTokens = true;
            var forgetDevices = true;
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userSessionsApi.RevokeUserSessionsWithHttpInfoAsync(userId, oauthTokens, forgetDevices);

            // Assert
            response.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.NoContent);
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().ContainKey("oauthTokens");
            mockClient.ReceivedQueryParams["oauthTokens"].Should().Contain("true");
            mockClient.ReceivedQueryParams.Should().ContainKey("forgetDevices");
            mockClient.ReceivedQueryParams["forgetDevices"].Should().Contain("true");
        }

        [Fact]
        public async Task RevokeUserSessions_WithDefaultParameters_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "test-user-defaults-123";
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId, default(bool?), default(bool?));

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task RevokeUserSessions_ReturnsNoContent()
        {
            // Arrange
            var userId = "test-user-no-content-123";
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert - Should not throw
            await userSessionsApi.RevokeUserSessionsAsync(userId);
            
            // Verify the call was made
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        #endregion

        #region Edge Case Tests

        [Fact]
        public async Task RevokeUserSessions_WithSpecialCharactersInUserId_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user@example.com";
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task RevokeUserSessions_WithComplexUserId_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user.name+test@example-domain.com";
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task EndUserSessions_WithComplexKeepCurrentObject_CallsCorrectEndpoint()
        {
            // Arrange
            var keepCurrent = new KeepCurrent { _KeepCurrent = true };
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.EndUserSessionsAsync(keepCurrent);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/me/lifecycle/delete_sessions");
            mockClient.ReceivedBody.Should().NotBeNullOrEmpty();
            mockClient.ReceivedBody.Should().Contain("keepCurrent");
        }

        [Fact]
        public async Task RevokeUserSessions_WithNullOptionalParameters_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "test-user-null-params-123";
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.RevokeUserSessionsAsync(userId, null, null);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/{userId}/sessions");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            // Null parameters should not appear in query params
            if (mockClient.ReceivedQueryParams != null)
            {
                mockClient.ReceivedQueryParams.Should().NotContainKey("oauthTokens");
                mockClient.ReceivedQueryParams.Should().NotContainKey("forgetDevices");
            }
        }

        [Fact]
        public async Task EndUserSessions_WithNullKeepCurrent_CallsCorrectEndpoint()
        {
            // Arrange
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userSessionsApi.EndUserSessionsAsync(null);

            // Assert
            mockClient.ReceivedPath.Should().Be("/api/v1/users/me/lifecycle/delete_sessions");
        }

        [Fact]
        public async Task RevokeUserSessions_ValidatesRequiredUserId()
        {
            // Arrange
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert
            await Assert.ThrowsAsync<Okta.Sdk.Client.ApiException>(
                () => userSessionsApi.RevokeUserSessionsAsync(null));
        }

        [Fact]
        public async Task RevokeUserSessions_ValidatesRequiredUserIdWithHttpInfo()
        {
            // Arrange
            var mockClient = new MockAsyncClient("", HttpStatusCode.NoContent);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act & Assert
            await Assert.ThrowsAsync<Okta.Sdk.Client.ApiException>(
                () => userSessionsApi.RevokeUserSessionsWithHttpInfoAsync(null));
        }

        #endregion

        #region HTTP Status Code Tests

        [Fact]
        public async Task EndUserSessions_WithOkStatus_ReturnsCorrectResponse()
        {
            // Arrange
            var mockClient = new MockAsyncClient("", HttpStatusCode.OK);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userSessionsApi.EndUserSessionsWithHttpInfoAsync();

            // Assert
            response.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.OK);
        }

        [Fact]
        public async Task RevokeUserSessions_WithOkStatus_ReturnsCorrectResponse()
        {
            // Arrange
            var userId = "test-user-ok-status-123";
            var mockClient = new MockAsyncClient("", HttpStatusCode.OK);
            var userSessionsApi = new UserSessionsApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userSessionsApi.RevokeUserSessionsWithHttpInfoAsync(userId);

            // Assert
            response.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.OK);
        }

        #endregion
    }
}
