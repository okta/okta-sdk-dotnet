/*
 * Okta API
 *
 * Allows customers to easily access the Okta API
 *
 * The version of the OpenAPI document: 5.1.0
 * Contact: devex-public@okta.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System.Threading.Tasks;
using FluentAssertions;
using Okta.Sdk.Api;
using Okta.Sdk.Client;
using Okta.Sdk.Model;
using Okta.Sdk.UnitTest.Internal;
using Xunit;

namespace Okta.Sdk.UnitTest.Api
{
    /// <summary>
    ///  Class for testing UserClassificationApi
    /// </summary>
    public class UserClassificationApiTests
    {
        #region GetUserClassification Tests

        [Fact]
        public async Task GetUserClassification_WithStandardClassification_ReturnsCorrectClassification()
        {
            // Arrange
            var userId = "user-classification-123";

            var responseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var classification = await userClassificationApi.GetUserClassificationAsync(userId);

            // Assert
            classification.Should().NotBeNull();
            classification.Type.Should().Be(ClassificationType.STANDARD);
            classification.LastUpdated.Should().NotBe(default);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task GetUserClassification_WithLiteClassification_ReturnsCorrectClassification()
        {
            // Arrange
            var userId = "user-classification-456";

            var responseJson = @"{
                ""type"": ""LITE"",
                ""lastUpdated"": ""2025-10-06T10:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var classification = await userClassificationApi.GetUserClassificationAsync(userId);

            // Assert
            classification.Should().NotBeNull();
            classification.Type.Should().Be(ClassificationType.LITE);
            classification.LastUpdated.Should().NotBe(default);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task GetUserClassification_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-classification-789";

            var responseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userClassificationApi.GetUserClassificationAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task GetUserClassification_WithValidUserId_ReturnsClassificationData()
        {
            // Arrange
            var userId = "user-valid-classification-001";
            var lastUpdatedDate = "2025-10-06T08:30:00.000Z";

            var responseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": """ + lastUpdatedDate + @"""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var classification = await userClassificationApi.GetUserClassificationAsync(userId);

            // Assert
            classification.Should().NotBeNull();
            classification.Type.Should().Be(ClassificationType.STANDARD);
            classification.LastUpdated.Should().NotBe(default);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        #endregion

        #region ReplaceUserClassification Tests

        [Fact]
        public async Task ReplaceUserClassification_ToStandard_ReturnsUpdatedClassification()
        {
            // Arrange
            var userId = "user-replace-123";

            var responseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": ""2025-10-06T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var replaceRequest = new ReplaceUserClassification
            {
                Type = ClassificationType.STANDARD
            };

            // Act
            var classification = await userClassificationApi.ReplaceUserClassificationAsync(userId, replaceRequest);

            // Assert
            classification.Should().NotBeNull();
            classification.Type.Should().Be(ClassificationType.STANDARD);
            classification.LastUpdated.Should().NotBe(default);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain("STANDARD");
        }

        [Fact]
        public async Task ReplaceUserClassification_ToLite_ReturnsUpdatedClassification()
        {
            // Arrange
            var userId = "user-replace-456";

            var responseJson = @"{
                ""type"": ""LITE"",
                ""lastUpdated"": ""2025-10-06T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var replaceRequest = new ReplaceUserClassification
            {
                Type = ClassificationType.LITE
            };

            // Act
            var classification = await userClassificationApi.ReplaceUserClassificationAsync(userId, replaceRequest);

            // Assert
            classification.Should().NotBeNull();
            classification.Type.Should().Be(ClassificationType.LITE);
            classification.LastUpdated.Should().NotBe(default);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain("LITE");
        }

        [Fact]
        public async Task ReplaceUserClassification_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-replace-789";

            var responseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": ""2025-10-06T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var replaceRequest = new ReplaceUserClassification
            {
                Type = ClassificationType.STANDARD
            };

            // Act
            await userClassificationApi.ReplaceUserClassificationAsync(userId, replaceRequest);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task ReplaceUserClassification_WithValidRequest_UpdatesLastUpdated()
        {
            // Arrange
            var userId = "user-replace-update-001";
            var updatedDate = "2025-10-06T15:30:00.000Z";

            var responseJson = @"{
                ""type"": ""LITE"",
                ""lastUpdated"": """ + updatedDate + @"""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var replaceRequest = new ReplaceUserClassification
            {
                Type = ClassificationType.LITE
            };

            // Act
            var classification = await userClassificationApi.ReplaceUserClassificationAsync(userId, replaceRequest);

            // Assert
            classification.Should().NotBeNull();
            classification.Type.Should().Be(ClassificationType.LITE);
            classification.LastUpdated.Should().NotBe(default);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain("LITE");
        }

        #endregion

        #region End-to-End Classification Management Scenario Tests

        [Fact]
        public async Task ClassificationManagement_GetThenReplace_CallsCorrectEndpoints()
        {
            // Arrange
            var userId = "user-scenario-123";

            // Test get classification
            var getResponseJson = @"{
                ""type"": ""LITE"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(getResponseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Get Classification
            var currentClassification = await userClassificationApi.GetUserClassificationAsync(userId);

            // Assert - Get Classification
            currentClassification.Should().NotBeNull();
            currentClassification.Type.Should().Be(ClassificationType.LITE);
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");

            // Setup for replace classification
            var replaceResponseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": ""2025-10-06T14:00:00.000Z""
            }";

            mockClient = new MockAsyncClient(replaceResponseJson);
            userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var replaceRequest = new ReplaceUserClassification
            {
                Type = ClassificationType.STANDARD
            };

            // Act - Replace Classification
            var updatedClassification = await userClassificationApi.ReplaceUserClassificationAsync(userId, replaceRequest);

            // Assert - Replace Classification
            updatedClassification.Should().NotBeNull();
            updatedClassification.Type.Should().Be(ClassificationType.STANDARD);
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedBody.Should().Contain("STANDARD");
        }

        [Fact]
        public async Task ClassificationManagement_UpgradeFromLiteToStandard_WorksCorrectly()
        {
            // Arrange
            var userId = "user-upgrade-456";

            // Test upgrade scenario: LITE -> STANDARD
            var upgradeResponseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": ""2025-10-06T16:45:00.000Z""
            }";

            var mockClient = new MockAsyncClient(upgradeResponseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var upgradeRequest = new ReplaceUserClassification
            {
                Type = ClassificationType.STANDARD
            };

            // Act
            var upgradedClassification = await userClassificationApi.ReplaceUserClassificationAsync(userId, upgradeRequest);

            // Assert
            upgradedClassification.Should().NotBeNull();
            upgradedClassification.Type.Should().Be(ClassificationType.STANDARD);
            upgradedClassification.LastUpdated.Should().NotBe(default);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain("STANDARD");
        }

        [Fact]
        public async Task ClassificationManagement_DowngradeFromStandardToLite_WorksCorrectly()
        {
            // Arrange
            var userId = "user-downgrade-789";

            // Test downgrade scenario: STANDARD -> LITE
            var downgradeResponseJson = @"{
                ""type"": ""LITE"",
                ""lastUpdated"": ""2025-10-06T18:20:00.000Z""
            }";

            var mockClient = new MockAsyncClient(downgradeResponseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var downgradeRequest = new ReplaceUserClassification
            {
                Type = ClassificationType.LITE
            };

            // Act
            var downgradedClassification = await userClassificationApi.ReplaceUserClassificationAsync(userId, downgradeRequest);

            // Assert
            downgradedClassification.Should().NotBeNull();
            downgradedClassification.Type.Should().Be(ClassificationType.LITE);
            downgradedClassification.LastUpdated.Should().NotBe(default);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain("LITE");
        }

        #endregion

        #region Edge Case Tests

        [Fact]
        public async Task GetUserClassification_WithEmptyUserId_StillCallsEndpoint()
        {
            // Arrange
            var userId = "";

            var responseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var classification = await userClassificationApi.GetUserClassificationAsync(userId);

            // Assert
            classification.Should().NotBeNull();
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
        }

        [Fact]
        public async Task ReplaceUserClassification_WithLongUserId_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-with-very-long-identifier-that-might-cause-issues-in-some-systems-123456789";

            var responseJson = @"{
                ""type"": ""LITE"",
                ""lastUpdated"": ""2025-10-06T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var replaceRequest = new ReplaceUserClassification
            {
                Type = ClassificationType.LITE
            };

            // Act
            await userClassificationApi.ReplaceUserClassificationAsync(userId, replaceRequest);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task GetUserClassification_WithSpecialCharactersInUserId_HandlesCorrectly()
        {
            // Arrange
            var userId = "user@special-chars_123.test";

            var responseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": ""2025-10-05T12:00:00.000Z""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var classification = await userClassificationApi.GetUserClassificationAsync(userId);

            // Assert
            classification.Should().NotBeNull();
            classification.Type.Should().Be(ClassificationType.STANDARD);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task ReplaceUserClassification_SameClassificationType_StillUpdatesTimestamp()
        {
            // Arrange
            var userId = "user-same-classification-001";
            var updatedDate = "2025-10-06T12:00:00.000Z";

            var responseJson = @"{
                ""type"": ""STANDARD"",
                ""lastUpdated"": """ + updatedDate + @"""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userClassificationApi = new UserClassificationApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var replaceRequest = new ReplaceUserClassification
            {
                Type = ClassificationType.STANDARD
            };

            // Act
            var classification = await userClassificationApi.ReplaceUserClassificationAsync(userId, replaceRequest);

            // Assert
            classification.Should().NotBeNull();
            classification.Type.Should().Be(ClassificationType.STANDARD);
            classification.LastUpdated.Should().NotBe(default);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/classification");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain("STANDARD");
        }

        #endregion
    }
}
