/*
 * Okta API
 *
 * Allows customers to easily access the Okta API
 *
 * The version of the OpenAPI document: 5.1.0
 * Contact: devex-public@okta.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System.Net;
using System.Threading.Tasks;
using FluentAssertions;
using Okta.Sdk.Api;
using Okta.Sdk.Client;
using Okta.Sdk.Model;
using Okta.Sdk.UnitTest.Internal;
using Xunit;

namespace Okta.Sdk.UnitTest.Api
{
    /// <summary>
    ///  Class for testing UserRiskApi
    /// </summary>
    public class UserRiskApiTests
    {
        #region GetUserRisk Tests

        [Fact]
        public async Task GetUserRisk_ReturnsUserRiskResponse()
        {
            // Arrange
            var userId = "user-risk-123";

            var responseJson = @"{
                ""riskLevel"": ""HIGH"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var userRisk = await userRiskApi.GetUserRiskAsync(userId);

            // Assert
            userRisk.Should().NotBeNull();
            userRisk.RiskLevel.Should().NotBeNull();
            userRisk.Links.Should().NotBeNull();

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task GetUserRisk_WithHttpInfo_ReturnsCorrectResponse()
        {
            // Arrange
            var userId = "user-risk-info-123";

            var responseJson = @"{
                ""riskLevel"": ""MEDIUM"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userRiskApi.GetUserRiskWithHttpInfoAsync(userId);

            // Assert
            response.Should().NotBeNull();
            response.Data.Should().NotBeNull();
            response.Data.RiskLevel.Should().NotBeNull();
            response.StatusCode.Should().Be(HttpStatusCode.OK);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task GetUserRisk_WithLowRiskLevel_ReturnsCorrectStructure()
        {
            // Arrange
            var userId = "user-low-risk-123";

            var responseJson = @"{
                ""riskLevel"": ""LOW"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var userRisk = await userRiskApi.GetUserRiskAsync(userId);

            // Assert
            userRisk.Should().NotBeNull();
            userRisk.RiskLevel.Should().NotBeNull();
            userRisk.Links.Should().NotBeNull();
        }

        [Fact]
        public async Task GetUserRisk_WithNoRiskLevel_ReturnsCorrectStructure()
        {
            // Arrange
            var userId = "user-no-risk-123";

            var responseJson = @"{
                ""riskLevel"": ""NONE"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var userRisk = await userRiskApi.GetUserRiskAsync(userId);

            // Assert
            userRisk.Should().NotBeNull();
            userRisk.RiskLevel.Should().NotBeNull();
        }

        [Fact]
        public async Task GetUserRisk_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-endpoint-123";

            var responseJson = @"{
                ""riskLevel"": ""HIGH"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userRiskApi.GetUserRiskAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        #endregion

        #region UpsertUserRisk Tests

        [Fact]
        public async Task UpsertUserRisk_WithHighRisk_ReturnsCorrectResponse()
        {
            // Arrange
            var userId = "user-upsert-high-123";
            var userRiskRequest = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.HIGH
            };

            var responseJson = @"{
                ""riskLevel"": ""HIGH"",
                ""reason"": ""User flagged as high risk"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userRiskApi.UpsertUserRiskAsync(userId, userRiskRequest);

            // Assert
            response.Should().NotBeNull();
            response.RiskLevel.Should().NotBeNull();
            response.Reason.Should().Be("User flagged as high risk");
            response.Links.Should().NotBeNull();

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().NotBeNullOrEmpty();
        }

        [Fact]
        public async Task UpsertUserRisk_WithLowRisk_ReturnsCorrectResponse()
        {
            // Arrange
            var userId = "user-upsert-low-123";
            var userRiskRequest = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.LOW
            };

            var responseJson = @"{
                ""riskLevel"": ""LOW"",
                ""reason"": ""User risk level reduced"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userRiskApi.UpsertUserRiskAsync(userId, userRiskRequest);

            // Assert
            response.Should().NotBeNull();
            response.RiskLevel.Should().NotBeNull();
            response.Reason.Should().Be("User risk level reduced");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task UpsertUserRisk_WithHttpInfo_ReturnsCorrectResponse()
        {
            // Arrange
            var userId = "user-upsert-info-123";
            var userRiskRequest = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.HIGH
            };

            var responseJson = @"{
                ""riskLevel"": ""HIGH"",
                ""reason"": ""Security incident detected"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userRiskApi.UpsertUserRiskWithHttpInfoAsync(userId, userRiskRequest);

            // Assert
            response.Should().NotBeNull();
            response.Data.Should().NotBeNull();
            response.Data.RiskLevel.Should().NotBeNull();
            response.Data.Reason.Should().Be("Security incident detected");
            response.StatusCode.Should().Be(HttpStatusCode.OK);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().NotBeNullOrEmpty();
        }

        [Fact]
        public async Task UpsertUserRisk_CreatesNewRisk_ReturnsCorrectResponse()
        {
            // Arrange
            var userId = "user-new-risk-123";
            var userRiskRequest = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.HIGH
            };

            var responseJson = @"{
                ""riskLevel"": ""HIGH"",
                ""reason"": ""Initial risk assessment"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson, HttpStatusCode.Created);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userRiskApi.UpsertUserRiskAsync(userId, userRiskRequest);

            // Assert
            response.Should().NotBeNull();
            response.RiskLevel.Should().NotBeNull();
            response.Reason.Should().Be("Initial risk assessment");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task UpsertUserRisk_UpdatesExistingRisk_ReturnsCorrectResponse()
        {
            // Arrange
            var userId = "user-update-risk-123";
            var userRiskRequest = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.LOW
            };

            var responseJson = @"{
                ""riskLevel"": ""LOW"",
                ""reason"": ""Risk level updated after review"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userRiskApi.UpsertUserRiskAsync(userId, userRiskRequest);

            // Assert
            response.Should().NotBeNull();
            response.RiskLevel.Should().NotBeNull();
            response.Reason.Should().Be("Risk level updated after review");
        }

        [Fact]
        public async Task UpsertUserRisk_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-upsert-endpoint-123";
            var userRiskRequest = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.HIGH
            };

            var responseJson = @"{
                ""riskLevel"": ""HIGH"",
                ""reason"": ""Risk assessment completed"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userRiskApi.UpsertUserRiskAsync(userId, userRiskRequest);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().NotBeNullOrEmpty();
        }

        #endregion

        #region Additional Edge Case Tests

        [Fact]
        public async Task GetUserRisk_WithSpecialCharactersInUserId_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-special@example.com";

            var responseJson = @"{
                ""riskLevel"": ""LOW"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userRiskApi.GetUserRiskAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task UpsertUserRisk_WithSpecialCharactersInUserId_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user_special-risk@example.com";
            var userRiskRequest = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.LOW
            };

            var responseJson = @"{
                ""riskLevel"": ""LOW"",
                ""reason"": ""Updated for special user"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userRiskApi.UpsertUserRiskAsync(userId, userRiskRequest);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task GetUserRisk_WithHighRiskLevel_ReturnsCorrectStructure()
        {
            // Arrange
            var userId = "user-high-risk-123";

            var responseJson = @"{
                ""riskLevel"": ""HIGH"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var userRisk = await userRiskApi.GetUserRiskAsync(userId);

            // Assert
            userRisk.Should().NotBeNull();
            userRisk.RiskLevel.Should().NotBeNull();
        }

        [Fact]
        public async Task UpsertUserRisk_WithDifferentRiskLevels_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-different-risk-123";
            var userRiskRequestHigh = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.HIGH
            };

            var responseJsonHigh = @"{
                ""riskLevel"": ""HIGH"",
                ""reason"": ""Elevated to high risk"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJsonHigh);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userRiskApi.UpsertUserRiskAsync(userId, userRiskRequestHigh);

            // Assert
            response.Should().NotBeNull();
            response.Reason.Should().Be("Elevated to high risk");

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task UpsertUserRisk_ValidatesRequestBody()
        {
            // Arrange
            var userId = "user-validate-123";
            var userRiskRequest = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.HIGH
            };

            var responseJson = @"{
                ""riskLevel"": ""HIGH"",
                ""reason"": ""Risk assessment validation"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userRiskApi.UpsertUserRiskAsync(userId, userRiskRequest);

            // Assert
            mockClient.ReceivedBody.Should().NotBeNullOrEmpty();
            mockClient.ReceivedBody.Should().Contain("HIGH");
        }

        [Fact]
        public async Task UpsertUserRisk_WithValidRequest_SendsCorrectData()
        {
            // Arrange
            var userId = "user-valid-request-123";
            var userRiskRequest = new UserRiskRequest
            {
                RiskLevel = UserRiskRequest.RiskLevelEnum.LOW
            };

            var responseJson = @"{
                ""riskLevel"": ""LOW"",
                ""reason"": ""Valid request processed"",
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"/risk""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userRiskApi = new UserRiskApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userRiskApi.UpsertUserRiskAsync(userId, userRiskRequest);

            // Assert
            response.Should().NotBeNull();
            mockClient.ReceivedBody.Should().Contain("LOW");
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/risk");
        }

        #endregion
    }
}
