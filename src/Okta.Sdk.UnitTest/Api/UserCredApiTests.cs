/*
 * Okta API
 *
 * Allows customers to easily access the Okta API
 *
 * The version of the OpenAPI document: 5.1.0
 * Contact: devex-public@okta.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System.Threading.Tasks;
using FluentAssertions;
using Okta.Sdk.Api;
using Okta.Sdk.Client;
using Okta.Sdk.Model;
using Okta.Sdk.UnitTest.Internal;
using Xunit;

namespace Okta.Sdk.UnitTest.Api
{
    /// <summary>
    ///  Class for testing UserCredApi
    /// </summary>
    public class UserCredApiTests
    {
        #region ChangePassword Tests

        [Fact]
        public async Task ChangePassword_WithValidCredentials_ReturnsUserCredentials()
        {
            // Arrange
            var userId = "user-change-password-123";
            var oldPassword = "OldPassword123!";
            var newPassword = "NewPassword456!";

            var responseJson = @"{
                ""password"": {},
                ""recovery_question"": {
                    ""question"": ""What is your favorite movie?""
                },
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var changePasswordRequest = new ChangePasswordRequest
            {
                OldPassword = new PasswordCredential { Value = oldPassword },
                NewPassword = new PasswordCredential { Value = newPassword }
            };

            // Act
            var credentials = await userCredApi.ChangePasswordAsync(userId, changePasswordRequest);

            // Assert
            credentials.Should().NotBeNull();
            credentials.Provider.Should().NotBeNull();
            credentials.Provider.Type.Should().Be(AuthenticationProviderType.OKTA);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/change_password");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain(newPassword);
        }

        [Fact]
        public async Task ChangePassword_WithStrictValidation_IncludesStrictParameter()
        {
            // Arrange
            var userId = "user-change-password-456";

            var responseJson = @"{
                ""password"": {},
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var changePasswordRequest = new ChangePasswordRequest
            {
                OldPassword = new PasswordCredential { Value = "OldPass123!" },
                NewPassword = new PasswordCredential { Value = "NewPass456!" }
            };

            // Act
            await userCredApi.ChangePasswordAsync(userId, changePasswordRequest, strict: true);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/change_password");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().NotBeNull();
        }

        [Fact]
        public async Task ChangePassword_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-change-password-789";

            var responseJson = @"{
                ""password"": {},
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var changePasswordRequest = new ChangePasswordRequest
            {
                OldPassword = new PasswordCredential { Value = "Test123!" },
                NewPassword = new PasswordCredential { Value = "Test456!" }
            };

            // Act
            await userCredApi.ChangePasswordAsync(userId, changePasswordRequest);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/change_password");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        #endregion

        #region ChangeRecoveryQuestion Tests

        [Fact]
        public async Task ChangeRecoveryQuestion_WithValidData_ReturnsUserCredentials()
        {
            // Arrange
            var userId = "user-recovery-123";
            var question = "What is your favorite pet's name?";
            var answer = "Fluffy";

            var responseJson = @"{
                ""password"": {},
                ""recovery_question"": {
                    ""question"": """ + question + @""",
                    ""answer"": """ + answer + @"""
                },
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var userCredentials = new UserCredentials
            {
                Password = new PasswordCredential { Value = "CurrentPassword123!" },
                RecoveryQuestion = new RecoveryQuestionCredential
                {
                    Question = question,
                    Answer = answer
                }
            };

            // Act
            var credentials = await userCredApi.ChangeRecoveryQuestionAsync(userId, userCredentials);

            // Assert
            credentials.Should().NotBeNull();
            credentials.RecoveryQuestion.Should().NotBeNull();
            credentials.RecoveryQuestion.Question.Should().Be(question);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/change_recovery_question");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain(question);
            mockClient.ReceivedBody.Should().Contain(answer);
        }

        [Fact]
        public async Task ChangeRecoveryQuestion_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-recovery-456";

            var responseJson = @"{
                ""password"": {},
                ""recovery_question"": {
                    ""question"": ""Test question?"",
                    ""answer"": ""Test answer""
                },
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var userCredentials = new UserCredentials
            {
                Password = new PasswordCredential { Value = "Test123!" },
                RecoveryQuestion = new RecoveryQuestionCredential
                {
                    Question = "Test question?",
                    Answer = "Test answer"
                }
            };

            // Act
            await userCredApi.ChangeRecoveryQuestionAsync(userId, userCredentials);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/change_recovery_question");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        #endregion

        #region ExpirePassword Tests

        [Fact]
        public async Task ExpirePassword_ReturnsUserWithExpiredStatus()
        {
            // Arrange
            var userId = "user-expire-123";

            var responseJson = @"{
                ""id"": """ + userId + @""",
                ""status"": ""PASSWORD_EXPIRED"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""activated"": ""2025-10-05T12:00:00.000Z"",
                ""statusChanged"": ""2025-10-06T12:00:00.000Z"",
                ""lastLogin"": null,
                ""lastUpdated"": ""2025-10-06T12:00:00.000Z"",
                ""passwordChanged"": ""2025-10-05T12:00:00.000Z"",
                ""profile"": {
                    ""firstName"": ""Expire"",
                    ""lastName"": ""Test"",
                    ""email"": ""expire@example.com"",
                    ""login"": ""expire@example.com""
                },
                ""credentials"": {
                    ""password"": {},
                    ""provider"": {
                        ""type"": ""OKTA"",
                        ""name"": ""OKTA""
                    }
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var user = await userCredApi.ExpirePasswordAsync(userId);

            // Assert
            user.Should().NotBeNull();
            user.Id.Should().Be(userId);
            user.Status.Should().Be(UserStatus.PASSWORDEXPIRED);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/expire_password");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        [Fact]
        public async Task ExpirePassword_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-expire-456";

            var responseJson = @"{
                ""id"": """ + userId + @""",
                ""status"": ""PASSWORD_EXPIRED"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""activated"": ""2025-10-05T12:00:00.000Z"",
                ""statusChanged"": ""2025-10-06T12:00:00.000Z"",
                ""lastLogin"": null,
                ""lastUpdated"": ""2025-10-06T12:00:00.000Z"",
                ""passwordChanged"": ""2025-10-05T12:00:00.000Z"",
                ""profile"": {
                    ""firstName"": ""Test"",
                    ""lastName"": ""User"",
                    ""email"": ""test@example.com"",
                    ""login"": ""test@example.com""
                },
                ""credentials"": {
                    ""password"": {},
                    ""provider"": {
                        ""type"": ""OKTA"",
                        ""name"": ""OKTA""
                    }
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userCredApi.ExpirePasswordAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/expire_password");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        #endregion

        #region ExpirePasswordWithTempPassword Tests

        [Fact]
        public async Task ExpirePasswordWithTempPassword_WithRevokeSessions_ReturnsUser()
        {
            // Arrange
            var userId = "user-temp-password-123";

            var responseJson = @"{
                ""id"": """ + userId + @""",
                ""status"": ""PASSWORD_EXPIRED"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""activated"": ""2025-10-05T12:00:00.000Z"",
                ""statusChanged"": ""2025-10-06T12:00:00.000Z"",
                ""lastLogin"": null,
                ""lastUpdated"": ""2025-10-06T12:00:00.000Z"",
                ""passwordChanged"": ""2025-10-06T12:00:00.000Z"",
                ""profile"": {
                    ""firstName"": ""Temp"",
                    ""lastName"": ""Password"",
                    ""email"": ""temp@example.com"",
                    ""login"": ""temp@example.com""
                },
                ""credentials"": {
                    ""password"": {
                        ""value"": ""TempPass123!""
                    },
                    ""provider"": {
                        ""type"": ""OKTA"",
                        ""name"": ""OKTA""
                    }
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var user = await userCredApi.ExpirePasswordWithTempPasswordAsync(userId, revokeSessions: true);

            // Assert
            user.Should().NotBeNull();
            user.Id.Should().Be(userId);
            user.Status.Should().Be(UserStatus.PASSWORDEXPIRED);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/expire_password_with_temp_password");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().NotBeNull();
        }

        [Fact]
        public async Task ExpirePasswordWithTempPassword_WithoutRevokeSession_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-temp-password-456";

            var responseJson = @"{
                ""id"": """ + userId + @""",
                ""status"": ""PASSWORD_EXPIRED"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""activated"": ""2025-10-05T12:00:00.000Z"",
                ""statusChanged"": ""2025-10-06T12:00:00.000Z"",
                ""lastLogin"": null,
                ""lastUpdated"": ""2025-10-06T12:00:00.000Z"",
                ""passwordChanged"": ""2025-10-06T12:00:00.000Z"",
                ""profile"": {
                    ""firstName"": ""Test"",
                    ""lastName"": ""User"",
                    ""email"": ""test@example.com"",
                    ""login"": ""test@example.com""
                },
                ""credentials"": {
                    ""password"": {
                        ""value"": ""TempPass456!""
                    },
                    ""provider"": {
                        ""type"": ""OKTA"",
                        ""name"": ""OKTA""
                    }
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userCredApi.ExpirePasswordWithTempPasswordAsync(userId, revokeSessions: false);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/expire_password_with_temp_password");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        #endregion

        #region ForgotPassword Tests

        [Fact]
        public async Task ForgotPassword_WithSendEmailTrue_ReturnsForgotPasswordResponse()
        {
            // Arrange
            var userId = "user-forgot-123";
            var resetPasswordUrl = "https://test.okta.com/reset/password?token=forgot123";

            var responseJson = @"{
                ""resetPasswordUrl"": """ + resetPasswordUrl + @"""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userCredApi.ForgotPasswordAsync(userId, sendEmail: true);

            // Assert
            response.Should().NotBeNull();
            response.ResetPasswordUrl.Should().Be(resetPasswordUrl);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/forgot_password");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().NotBeNull();
        }

        [Fact]
        public async Task ForgotPassword_WithSendEmailFalse_ReturnsForgotPasswordResponse()
        {
            // Arrange
            var userId = "user-forgot-456";
            var resetPasswordUrl = "https://test.okta.com/reset/password?token=forgot456";

            var responseJson = @"{
                ""resetPasswordUrl"": """ + resetPasswordUrl + @"""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var response = await userCredApi.ForgotPasswordAsync(userId, sendEmail: false);

            // Assert
            response.Should().NotBeNull();
            response.ResetPasswordUrl.Should().Be(resetPasswordUrl);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/forgot_password");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        [Fact]
        public async Task ForgotPassword_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-forgot-789";

            var responseJson = @"{
                ""resetPasswordUrl"": ""https://test.okta.com/reset/password?token=forgot789""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userCredApi.ForgotPasswordAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/forgot_password");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        #endregion

        #region ForgotPasswordSetNewPassword Tests

        [Fact]
        public async Task ForgotPasswordSetNewPassword_WithValidAnswer_ReturnsUserCredentials()
        {
            // Arrange
            var userId = "user-forgot-set-123";
            var newPassword = "NewPassword123!";
            var recoveryAnswer = "My favorite pet";

            var responseJson = @"{
                ""password"": {},
                ""recovery_question"": {
                    ""question"": ""What is your favorite pet's name?"",
                    ""answer"": """ + recoveryAnswer + @"""
                },
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var userCredentials = new UserCredentials
            {
                Password = new PasswordCredential { Value = newPassword },
                RecoveryQuestion = new RecoveryQuestionCredential
                {
                    Answer = recoveryAnswer
                }
            };

            // Act
            var credentials = await userCredApi.ForgotPasswordSetNewPasswordAsync(userId, userCredentials, sendEmail: false);

            // Assert
            credentials.Should().NotBeNull();
            credentials.Provider.Type.Should().Be(AuthenticationProviderType.OKTA);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/forgot_password_recovery_question");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
            mockClient.ReceivedBody.Should().Contain(newPassword);
            mockClient.ReceivedBody.Should().Contain(recoveryAnswer);
        }

        [Fact]
        public async Task ForgotPasswordSetNewPassword_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-forgot-set-456";

            var responseJson = @"{
                ""password"": {},
                ""recovery_question"": {
                    ""question"": ""Test question?"",
                    ""answer"": ""Test answer""
                },
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var userCredentials = new UserCredentials
            {
                Password = new PasswordCredential { Value = "TestPassword123!" },
                RecoveryQuestion = new RecoveryQuestionCredential
                {
                    Answer = "Test answer"
                }
            };

            // Act
            await userCredApi.ForgotPasswordSetNewPasswordAsync(userId, userCredentials);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/forgot_password_recovery_question");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
            mockClient.ReceivedPathParams["userId"].Should().Contain(userId);
        }

        #endregion

        #region ResetPassword Tests

        [Fact]
        public async Task ResetPassword_WithSendEmailTrue_ReturnsResetPasswordToken()
        {
            // Arrange
            var userId = "user-reset-123";
            var resetPasswordUrl = "https://test.okta.com/reset/password?token=reset123";

            var responseJson = @"{
                ""resetPasswordUrl"": """ + resetPasswordUrl + @"""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var resetToken = await userCredApi.ResetPasswordAsync(userId, sendEmail: true, revokeSessions: false);

            // Assert
            resetToken.Should().NotBeNull();
            resetToken.ResetPasswordUrl.Should().Be(resetPasswordUrl);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/reset_password");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().NotBeNull();
        }

        [Fact]
        public async Task ResetPassword_WithRevokeSessions_IncludesRevokeParameter()
        {
            // Arrange
            var userId = "user-reset-456";
            var resetPasswordUrl = "https://test.okta.com/reset/password?token=reset456";

            var responseJson = @"{
                ""resetPasswordUrl"": """ + resetPasswordUrl + @"""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            var resetToken = await userCredApi.ResetPasswordAsync(userId, sendEmail: false, revokeSessions: true);

            // Assert
            resetToken.Should().NotBeNull();
            resetToken.ResetPasswordUrl.Should().Be(resetPasswordUrl);

            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/reset_password");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
            mockClient.ReceivedQueryParams.Should().NotBeNull();
        }

        [Fact]
        public async Task ResetPassword_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-reset-789";

            var responseJson = @"{
                ""resetPasswordUrl"": ""https://test.okta.com/reset/password?token=reset789""
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userCredApi.ResetPasswordAsync(userId, sendEmail: true);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/reset_password");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        #endregion

        #region End-to-End Credential Management Scenario Tests

        [Fact]
        public async Task CredentialManagement_PasswordResetFlow_CallsCorrectEndpoints()
        {
            // Arrange
            var userId = "user-scenario-123";

            // Test forgot password
            var forgotPasswordResponseJson = @"{
                ""resetPasswordUrl"": ""https://test.okta.com/reset/password?token=scenario123""
            }";

            var mockClient = new MockAsyncClient(forgotPasswordResponseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Forgot Password
            var forgotResponse = await userCredApi.ForgotPasswordAsync(userId, sendEmail: false);

            // Assert - Forgot Password
            forgotResponse.Should().NotBeNull();
            forgotResponse.ResetPasswordUrl.Should().Contain("scenario123");
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/forgot_password");

            // Setup for password reset
            var resetPasswordResponseJson = @"{
                ""resetPasswordUrl"": ""https://test.okta.com/reset/password?token=reset123""
            }";

            mockClient = new MockAsyncClient(resetPasswordResponseJson);
            userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act - Reset Password
            var resetToken = await userCredApi.ResetPasswordAsync(userId, sendEmail: true, revokeSessions: true);

            // Assert - Reset Password
            resetToken.Should().NotBeNull();
            resetToken.ResetPasswordUrl.Should().Contain("reset123");
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/reset_password");
        }

        [Fact]
        public async Task CredentialManagement_PasswordChangeFlow_CallsCorrectEndpoints()
        {
            // Arrange
            var userId = "user-change-scenario-456";

            // Test password change
            var changePasswordResponseJson = @"{
                ""password"": {},
                ""recovery_question"": {
                    ""question"": ""What is your favorite movie?""
                },
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            var mockClient = new MockAsyncClient(changePasswordResponseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var changePasswordRequest = new ChangePasswordRequest
            {
                OldPassword = new PasswordCredential { Value = "OldPassword123!" },
                NewPassword = new PasswordCredential { Value = "NewPassword456!" }
            };

            // Act - Change Password
            var credentials = await userCredApi.ChangePasswordAsync(userId, changePasswordRequest, strict: false);

            // Assert - Change Password
            credentials.Should().NotBeNull();
            credentials.Provider.Type.Should().Be(AuthenticationProviderType.OKTA);
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/change_password");

            // Setup for recovery question change
            var changeRecoveryResponseJson = @"{
                ""password"": {},
                ""recovery_question"": {
                    ""question"": ""What is your pet's name?"",
                    ""answer"": ""Fluffy""
                },
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            mockClient = new MockAsyncClient(changeRecoveryResponseJson);
            userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var userCredentials = new UserCredentials
            {
                Password = new PasswordCredential { Value = "NewPassword456!" },
                RecoveryQuestion = new RecoveryQuestionCredential
                {
                    Question = "What is your pet's name?",
                    Answer = "Fluffy"
                }
            };

            // Act - Change Recovery Question
            var updatedCredentials = await userCredApi.ChangeRecoveryQuestionAsync(userId, userCredentials);

            // Assert - Change Recovery Question
            updatedCredentials.Should().NotBeNull();
            updatedCredentials.RecoveryQuestion.Question.Should().Be("What is your pet's name?");
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/change_recovery_question");
        }

        #endregion

        #region Edge Case Tests

        [Fact]
        public async Task ChangePassword_WithEmptyUserId_StillCallsEndpoint()
        {
            // Arrange
            var userId = "";

            var responseJson = @"{
                ""password"": {},
                ""provider"": {
                    ""type"": ""OKTA"",
                    ""name"": ""OKTA""
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            var changePasswordRequest = new ChangePasswordRequest
            {
                OldPassword = new PasswordCredential { Value = "Old123!" },
                NewPassword = new PasswordCredential { Value = "New456!" }
            };

            // Act
            var credentials = await userCredApi.ChangePasswordAsync(userId, changePasswordRequest);

            // Assert
            credentials.Should().NotBeNull();
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{userId}/credentials/change_password");
            mockClient.ReceivedPathParams.Should().ContainKey("userId");
        }

        [Fact]
        public async Task ExpirePassword_WithLongUserId_CallsCorrectEndpoint()
        {
            // Arrange
            var userId = "user-with-very-long-identifier-that-might-cause-issues-in-some-systems-123456789";

            var responseJson = @"{
                ""id"": """ + userId + @""",
                ""status"": ""PASSWORD_EXPIRED"",
                ""created"": ""2025-10-05T12:00:00.000Z"",
                ""activated"": ""2025-10-05T12:00:00.000Z"",
                ""statusChanged"": ""2025-10-06T12:00:00.000Z"",
                ""lastLogin"": null,
                ""lastUpdated"": ""2025-10-06T12:00:00.000Z"",
                ""passwordChanged"": ""2025-10-05T12:00:00.000Z"",
                ""profile"": {
                    ""firstName"": ""Long"",
                    ""lastName"": ""User"",
                    ""email"": ""long@example.com"",
                    ""login"": ""long@example.com""
                },
                ""credentials"": {
                    ""password"": {},
                    ""provider"": {
                        ""type"": ""OKTA"",
                        ""name"": ""OKTA""
                    }
                },
                ""_links"": {
                    ""self"": {
                        ""href"": ""https://test.okta.com/api/v1/users/" + userId + @"""
                    }
                }
            }";

            var mockClient = new MockAsyncClient(responseJson);
            var userCredApi = new UserCredApi(mockClient, new Configuration { BasePath = "https://test.okta.com" });

            // Act
            await userCredApi.ExpirePasswordAsync(userId);

            // Assert
            mockClient.ReceivedPath.Should().StartWith("/api/v1/users/{id}/lifecycle/expire_password");
            mockClient.ReceivedPathParams.Should().ContainKey("id");
            mockClient.ReceivedPathParams["id"].Should().Contain(userId);
        }

        #endregion
    }
}
